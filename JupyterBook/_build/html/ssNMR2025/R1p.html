
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>\(R_{1\rho}\) simulation and analysis &#8212; Conference Tutorials</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ssNMR2025/R1p';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Solid-State NMR 2025" href="ssNMR2025.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Conference Tutorials</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Conference Tutorials
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Software.html">Software</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../GNMR2025/GNMR2025.html"><font color="#5d6d7e"> G-NMR 2025 </font></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../GNMR2025/Exchange.html"><font color="#2e86c1"> Chemical Exchange </font></a></li>
<li class="toctree-l2"><a class="reference internal" href="../GNMR2025/MD2NMR.html"><font color="#2e86c1"> Calculating NMR Parameters from MD Simulations 1: S<span class="math notranslate nohighlight">\(^2\)</span> and C(t) </font></a></li>
<li class="toctree-l2"><a class="reference internal" href="../GNMR2025/MD2NMR_fitting.html"><font color="#2e86c1"> Calculating NMR Parameters from MD Simulations 2: Calculating Relaxation </font></a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="ssNMR2025.html"><font color="#5d6d7e"> Solid-State NMR 2025 </font></a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#"><font color="#2e86c1"> <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> simulation and analysis</font></a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/alsinmr/ConferenceExamples/blob/master/JupyterBook/ssNMR2025/R1p.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/alsinmr/ConferenceExamples" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/alsinmr/ConferenceExamples/issues/new?title=Issue%20on%20page%20%2FssNMR2025/R1p.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/ssNMR2025/R1p.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1><font color=#2e86c1> R_{1\rho} simulation and analysis</font></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1-simulating-r-1-rho">Part 1: Simulating <span class="math notranslate nohighlight">\(R_{1\rho}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#python-setup">Python Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-setup">Simulation Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">Parameters</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#build-the-experimental-systems">Build the experimental systems</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#couple-systems-into-a-liouvillian-generate-a-pulse-sequence">Couple systems into a Liouvillian, generate a pulse sequence</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-density-matrix-propagate">Create a density matrix, propagate</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-results">Plot the results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-functions-for-faster-setup">Create functions for faster setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-relaxation-for-various-conditions">Examine relaxation for various conditions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sources-of-multiexpontiality">Sources of multiexpontiality</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#field-strength-and-correlation-time-dependence-of-r-1-rho">Field strength and correlation time dependence of <span class="math notranslate nohighlight">\(R_{1\rho}\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bonus-edit-the-following-code-to-simulate-t-1-relaxation-instead-of-t-1-rho">Bonus: Edit the following code to simulate T<span class="math notranslate nohighlight">\(_1\)</span> relaxation instead of T<span class="math notranslate nohighlight">\(_{1\rho}\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2-fitting-bloch-mcconnell-relaxation-dispersion-data">Part 2: Fitting Bloch-McConnell Relaxation Dispersion Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#formulas-for-relaxation-behavior">Formulas for relaxation behavior</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulate-a-dataset">Simulate a dataset</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="r-1-rho-simulation-and-analysis">
<h1><font color=#2e86c1> <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> simulation and analysis</font><a class="headerlink" href="#r-1-rho-simulation-and-analysis" title="Link to this heading">#</a></h1>
<p><a href="https://githubtocolab.com/alsinmr/ConferenceExamples/blob/master/JupyterBook/ssNMR2025/R1p_COLAB.ipynb" target="_blank"><img alt="https://colab.research.google.com/assets/colab-badge.svg" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<p>The <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> experiment is a useful experiment for characterizing slow (<span class="math notranslate nohighlight">\(\mu\)</span>s/ms) motion in solid-state NMR. The pulse sequence involves flipping magnetization of a spin (often <span class="math notranslate nohighlight">\(^{15}\)</span>N or <span class="math notranslate nohighlight">\(^{13}\)</span>C, CP-based excitation also possible) to the x-axis, spin-locking that magnetization, and observing its decay (again, CP-transfer back to <span class="math notranslate nohighlight">\(^1\)</span>H may be useful).</p>
<a class="reference internal image-reference" href="../_images/R1p_sequence.png"><img alt="sequence" src="../_images/R1p_sequence.png" style="width: 300px;" /></a>
<p>This experiment is sensitive to both reorientational motion of anisotropic tensors (dipole/CSA) and changes to the isotropic chemical shift. In the first part of this exercise, we will use simulation to explore the relaxation behavior of the <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> experiment, and in the second part, we will fit <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> measurements to extract dynamics parameters from a data set.</p>
<section id="part-1-simulating-r-1-rho">
<h2>Part 1: Simulating <span class="math notranslate nohighlight">\(R_{1\rho}\)</span><a class="headerlink" href="#part-1-simulating-r-1-rho" title="Link to this heading">#</a></h2>
<p>Relaxation can be simulated by creating a spin system that exchanges between two states stochastically, thereby inducing various relaxation processes. For <span class="math notranslate nohighlight">\(R_{1\rho}\)</span>, we simply need to use such a system with a spin-lock on one of the spins. Below, we set up the SLEEPY code for a basic <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> experiment.</p>
<section id="python-setup">
<h3>Python Setup<a class="headerlink" href="#python-setup" title="Link to this heading">#</a></h3>
<p>If SLEEPY is not already installed (e.g. if working in Google Colab), then we need to install it. We then need to import the SLEEPY module, as well as numpy which has a lot of linear algebra and other mathematical tools, and matplotlib, which is used to create figures. We also turn off messages from SLEEPY.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="k">if</span> <span class="s1">&#39;google.colab&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span> <span class="c1">#Colab</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>sleepy-nmr
<span class="kn">import</span><span class="w"> </span><span class="nn">SLEEPY</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">curve_fit</span>
<span class="n">sl</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="simulation-setup">
<h3>Simulation Setup<a class="headerlink" href="#simulation-setup" title="Link to this heading">#</a></h3>
<p>Setup contains similar parameters as SIMPSON, with an important distinction: we set up the system
twice (ex0,ex1) with different Euler angles, to introduce reorientational motion, and with a different chemical shift, to introduce chemical exchange.</p>
<p>Reorientational motion is introduced by putting a dipole and/or CSA into both ex0 and ex1, with the same coupling size, but with a different set of Euler angles (usually introduced on the beta angle). Here, we use both the dipole and CSA as would be typical for <span class="math notranslate nohighlight">\(^{15}\)</span>N in the protein backbone.</p>
<p>Chemical exchange is introduced by including a chemical shift that changes value between ex0 and ex1.</p>
<p>Note that this setup means reorientation and chemical exchange are simultaneous processes.</p>
<section id="parameters">
<h4>Parameters<a class="headerlink" href="#parameters" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># H-N dipole coupling for 0.102 nm</span>
<span class="c1"># Note, this value is the dipole anisotropy,</span>
<span class="c1"># which is twice the size of the coupling given in SIMPSON</span>
<span class="n">deltaHN</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">dipole_coupling</span><span class="p">(</span><span class="mf">.102</span><span class="p">,</span><span class="s1">&#39;1H&#39;</span><span class="p">,</span><span class="s1">&#39;15N&#39;</span><span class="p">)</span>
<span class="c1"># Typical protein backbone 15N CSA</span>
<span class="n">deltaCSA</span><span class="o">=</span><span class="mi">113</span>
<span class="c1"># Change in the 15N chemical shift</span>
<span class="n">DelCS</span><span class="o">=</span><span class="mi">10</span>
<span class="c1"># Hop angle</span>
<span class="n">hop_angle</span><span class="o">=</span><span class="mi">25</span>
<span class="c1"># Correlation time of the exchange</span>
<span class="n">tc</span><span class="o">=</span><span class="mf">1e-5</span>
<span class="c1"># Population of state 1</span>
<span class="n">p1</span><span class="o">=</span><span class="mf">0.5</span>
<span class="c1"># Spin-lock strength</span>
<span class="n">v1</span><span class="o">=</span><span class="mi">35000</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="build-the-experimental-systems">
<h4>Build the experimental systems<a class="headerlink" href="#build-the-experimental-systems" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Magnetic field (MHz), Nuclei, spinning rate, powder-average quality</span>
<span class="n">ex0</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">ExpSys</span><span class="p">(</span><span class="n">v0H</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">Nucs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;15N&#39;</span><span class="p">,</span><span class="s1">&#39;1H&#39;</span><span class="p">],</span><span class="n">vr</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span><span class="n">pwdavg</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">n_gamma</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="c1"># H–N dipole coupling, i0: spin 0, i1: spin 1, delta: anisotropy of interaction</span>
<span class="n">ex0</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;dipole&#39;</span><span class="p">,</span><span class="n">i0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">i1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaHN</span><span class="p">)</span>
<span class="c1"># 15N CSA, i: spin, delta: anisotropy in ppm, euler_d: Euler angles in degrees</span>
<span class="n">ex0</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CSA&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaCSA</span><span class="p">,</span><span class="n">euler_d</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">120</span><span class="p">])</span>
<span class="c1"># 15N chemical shift, i: spin, CS: chemical shift in ppm</span>
<span class="n">ex0</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CS&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ppm</span><span class="o">=</span><span class="n">DelCS</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Copy ex0 (links copies, ensures matching experimental settings)</span>
<span class="n">ex1</span><span class="o">=</span><span class="n">ex0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># As above, plus tilt the dipole coupling by the hop_angle</span>
<span class="n">ex1</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;dipole&#39;</span><span class="p">,</span><span class="n">i0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">i1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaHN</span><span class="p">,</span><span class="n">euler_d</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">hop_angle</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># As above, plus add a second set of Euler angles with the hop angle</span>
<span class="n">ex1</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CSA&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaCSA</span><span class="p">,</span><span class="n">euler_d</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">120</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">hop_angle</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
<span class="c1"># As above, but change CS</span>
<span class="n">_</span><span class="o">=</span><span class="n">ex1</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CS&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ppm</span><span class="o">=-</span><span class="n">DelCS</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># _ captures the output, reducing clutter</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="couple-systems-into-a-liouvillian-generate-a-pulse-sequence">
<h4>Couple systems into a Liouvillian, generate a pulse sequence<a class="headerlink" href="#couple-systems-into-a-liouvillian-generate-a-pulse-sequence" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a Liouvillian with two systems in exchange</span>
<span class="n">L</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Liouvillian</span><span class="p">(</span><span class="n">ex0</span><span class="p">,</span><span class="n">ex1</span><span class="p">)</span>
<span class="c1"># Add an exchange matrix betweent the two systems</span>
<span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span><span class="n">p1</span><span class="o">=</span><span class="n">p1</span><span class="p">)</span>

<span class="c1"># Create a pulse sequence object</span>
<span class="n">seq</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">Sequence</span><span class="p">()</span>
<span class="c1"># Add a spin-locking field </span>
<span class="c1"># For continuous field, we can just specify power</span>
<span class="c1"># but including a time axis with varying power, phase, and offset is also possible</span>
<span class="n">_</span><span class="o">=</span><span class="n">seq</span><span class="o">.</span><span class="n">add_channel</span><span class="p">(</span><span class="s1">&#39;15N&#39;</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">)</span>
<span class="c1"># Note that the default sequence length is 1 rotor period if the time axis is not given</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-a-density-matrix-propagate">
<h4>Create a density matrix, propagate<a class="headerlink" href="#create-a-density-matrix-propagate" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initial state of density matrix, detection matrix</span>
<span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;15Nx&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="s1">&#39;15Nx&#39;</span><span class="p">)</span>
<span class="c1"># Propagate for 100 ms (n is number of steps, use int() to get an integer)</span>
<span class="n">_</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">DetProp</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span><span class="o">*</span><span class="n">ex0</span><span class="o">.</span><span class="n">vr</span><span class="p">))</span> 
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="plot-the-results">
<h3>Plot the results<a class="headerlink" href="#plot-the-results" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3b290e57a00afcf214ed153895157186f6efbc3c51a2c55cbb4ae82163a68fcb.png" src="../_images/3b290e57a00afcf214ed153895157186f6efbc3c51a2c55cbb4ae82163a68fcb.png" />
</div>
</div>
</section>
<section id="create-functions-for-faster-setup">
<h3>Create functions for faster setup<a class="headerlink" href="#create-functions-for-faster-setup" title="Link to this heading">#</a></h3>
<p>If we want to repeat calculations under varying conditions, it can be easier to wrap the setup up in a function, and then we can just call that function later. Two functions are generated here:</p>
<ul class="simple">
<li><p>R1pU : Propagator for 1 rotor period. Optionally adjust correlation time (tc, s), populations (p1), hop angle (hop_angle, degrees), size of chemical exchange (DelCS, ppm), applied field strength (v1, Hz).</p></li>
<li><p>R1p_rho : Density matrix, propagated for 100 ms. Same arguments as R1pU.</p></li>
</ul>
<p>There’s not much new in terms of SLEEPY in the code below. Skip over, or read more carefully if you’re interested in how to setup a function in Python.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">R1pU</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span><span class="n">p1</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span><span class="n">hop_angle</span><span class="o">=</span><span class="n">hop_angle</span><span class="p">,</span><span class="n">DelCS</span><span class="o">=</span><span class="n">DelCS</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="mi">120</span><span class="p">):</span>
    <span class="n">ex0</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">ExpSys</span><span class="p">(</span><span class="n">v0H</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">Nucs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;15N&#39;</span><span class="p">,</span><span class="s1">&#39;1H&#39;</span><span class="p">],</span><span class="n">vr</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span><span class="n">pwdavg</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">n_gamma</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hop_angle</span><span class="p">:</span>
        <span class="n">ex0</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;dipole&#39;</span><span class="p">,</span><span class="n">i0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">i1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaHN</span><span class="p">,</span><span class="n">euler_d</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">hop_angle</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ex0</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CSA&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaCSA</span><span class="p">,</span><span class="n">euler_d</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="n">gamma</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">hop_angle</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">ex0</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CS&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ppm</span><span class="o">=</span><span class="n">DelCS</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">ex1</span><span class="o">=</span><span class="n">ex0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">hop_angle</span><span class="p">:</span>
        <span class="n">ex1</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;dipole&#39;</span><span class="p">,</span><span class="n">i0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">i1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaHN</span><span class="p">,</span><span class="n">euler_d</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">hop_angle</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ex1</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CSA&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaCSA</span><span class="p">,</span><span class="n">euler_d</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="n">gamma</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">hop_angle</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">ex1</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CS&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ppm</span><span class="o">=-</span><span class="n">DelCS</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">L</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Liouvillian</span><span class="p">(</span><span class="n">ex0</span><span class="p">,</span><span class="n">ex1</span><span class="p">)</span>
    <span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span><span class="n">p1</span><span class="o">=</span><span class="n">p1</span><span class="p">)</span>
    
    <span class="n">seq</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">Sequence</span><span class="p">(</span><span class="n">Dt</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">60000</span><span class="p">)</span>
    <span class="n">seq</span><span class="o">.</span><span class="n">add_channel</span><span class="p">(</span><span class="s1">&#39;15N&#39;</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">seq</span><span class="o">.</span><span class="n">U</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">R1p_rho</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span><span class="n">p1</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span><span class="n">hop_angle</span><span class="o">=</span><span class="n">hop_angle</span><span class="p">,</span><span class="n">DelCS</span><span class="o">=</span><span class="n">DelCS</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">):</span>
    <span class="n">U</span><span class="o">=</span><span class="n">R1pU</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span><span class="n">p1</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span><span class="n">hop_angle</span><span class="o">=</span><span class="n">hop_angle</span><span class="p">,</span><span class="n">DelCS</span><span class="o">=</span><span class="n">DelCS</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">)</span>
    <span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;15Nx&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="s1">&#39;15Nx&#39;</span><span class="p">)</span>
    <span class="n">rho</span><span class="o">.</span><span class="n">DetProp</span><span class="p">(</span><span class="n">U</span><span class="o">**</span><span class="nb">int</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">expsys</span><span class="o">.</span><span class="n">vr</span><span class="o">/</span><span class="mi">1000</span><span class="p">),</span><span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rho</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="examine-relaxation-for-various-conditions">
<h3>Examine relaxation for various conditions<a class="headerlink" href="#examine-relaxation-for-various-conditions" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>High spin-lock strength (35 kHz)</p>
<p>We’ll first calculate relaxation with both reorientational dynamics and chemical exchange. Then, we’ll calculate each process separately to see which dominates the relaxation at this field strength.</p>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v1</span><span class="o">=</span><span class="mi">35000</span>
<span class="n">rho</span><span class="o">=</span><span class="n">R1p_rho</span><span class="p">(</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">)</span>
<span class="n">rho_hop</span><span class="o">=</span><span class="n">R1p_rho</span><span class="p">(</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">,</span><span class="n">DelCS</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#Sets the chemical exchange to 0</span>
<span class="n">rho_ex</span><span class="o">=</span><span class="n">R1p_rho</span><span class="p">(</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">,</span><span class="n">hop_angle</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#Sets the reorientational motion to 0</span>

<span class="n">ax</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;hopping+exchange&#39;</span><span class="p">)</span>   <span class="c1">#plot returns an axis, which we can use for the subsequent plots</span>
<span class="n">rho_hop</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;hopping only&#39;</span><span class="p">)</span> <span class="c1">#Now use ax as an argument</span>
<span class="n">rho_ex</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;exchange only&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>  <span class="c1">#Make the axis go down to 0</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>  <span class="c1">#Show a legend with the labels given above</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d3bc976e580ba6d880c770c76c454deccd635bbd5526ba199d8e347dedfb4446.png" src="../_images/d3bc976e580ba6d880c770c76c454deccd635bbd5526ba199d8e347dedfb4446.png" />
</div>
</div>
<p><strong>Q:</strong> At 35 kHz, what is the dominant relaxation process, reorientational dynamics, or chemical exchange?</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Answer</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">Relaxation due to reorientation is much faster, where removing exchange has only a minor impact on the relaxation curve.</p>
</div>
</details><ol class="arabic" start="2">
<li><p>Low spin-lock strength (4 kHz)</p>
<p>We repeat the above calculation, but with only 4 kHz spin-lock.</p>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v1</span><span class="o">=</span><span class="mi">4000</span>
<span class="n">rho</span><span class="o">=</span><span class="n">R1p_rho</span><span class="p">(</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">)</span>
<span class="n">rho_hop</span><span class="o">=</span><span class="n">R1p_rho</span><span class="p">(</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">,</span><span class="n">DelCS</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#Sets the chemical exchange to 0</span>
<span class="n">rho_ex</span><span class="o">=</span><span class="n">R1p_rho</span><span class="p">(</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">,</span><span class="n">hop_angle</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#Sets the reorientational motion to 0</span>

<span class="n">ax</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;hopping+exchange&#39;</span><span class="p">)</span>   <span class="c1">#plot returns an axis, which we can use for the subsequent plots</span>
<span class="n">rho_hop</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;hopping only&#39;</span><span class="p">)</span> <span class="c1">#Now use ax as an argument</span>
<span class="n">rho_ex</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;exchange only&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>  <span class="c1">#Make the axis go down to 0</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>  <span class="c1">#Show a legend with the labels given above</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fe2d32f31f0&gt;
</pre></div>
</div>
<img alt="../_images/ccf9647b1ad64adaff8fa2524381054009d89b0b74757464040a98970f327115.png" src="../_images/ccf9647b1ad64adaff8fa2524381054009d89b0b74757464040a98970f327115.png" />
</div>
</div>
<p><strong>Q:</strong> Compare the curves for hopping only and exchange only. Why do the curves cross?</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Answer</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">The initial decay from hopping is faster, but by the end of the plot, more decay has occurred for exchange. The curves cross because the exchange process yields a monoexponentially decaying signal, whereas the hopping process yields multiexponential decay.</p>
</div>
</details><section id="sources-of-multiexpontiality">
<h4>Sources of multiexpontiality<a class="headerlink" href="#sources-of-multiexpontiality" title="Link to this heading">#</a></h4>
<p><strong>Q:</strong> Above, we noticed that hopping yields multiexponential decay. Give one reason for the multiexponential decay (there are actually two sources, but we start with the one that is more obvious to me)</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Answer</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">The first reason is that different elements of the powder average relax with different rate constants. SLEEPY lets us plot individual elements of the powder average, so let’s check if relaxation becomes monoexponential! (reveal hidden cell below)</p>
</div>
</details><div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pwd_index</span><span class="o">=</span><span class="mi">5</span>
<span class="n">ax</span><span class="o">=</span><span class="n">rho_hop</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pwd_index</span><span class="o">=</span><span class="n">pwd_index</span><span class="p">)</span>     <span class="c1">#pwd_index specifies which element of the powder element to display</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#Adjust the y-axis</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/71eb6da2dc90a5ba0c1cab4cff0a4c1c5111a2b7bfa5cfbbf9e64d91d1bc2d78.png" src="../_images/71eb6da2dc90a5ba0c1cab4cff0a4c1c5111a2b7bfa5cfbbf9e64d91d1bc2d78.png" />
</div>
</details>
</div>
<p><strong>Q:</strong> So, the curve is still bi-exponential. Then, what is the second reason for multi-exponentiality?
<em>Hint: What interactions undergo reorientational motion?</em></p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Answer</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">Both the CSA and dipole coupling are undergoing reorientational dynamics. Then, depending if the <span class="math notranslate nohighlight">\(^1\)</span>H is spin-up or spin-down, the CSA/dipole relaxation will be additive or subtractive, yielding different relaxation rates. Reveal the cell below, where we separate the <span class="math notranslate nohighlight">\(^1\)</span>H spin-up (alpha) and spin-down (beta) states.</p>
</div>
</details><div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#ex0.Op are the spin-operator matrices.</span>
<span class="c1">#Index for the desired spin and then get x,y,z,p(+),m(-),alpha, or beta matrices</span>
<span class="c1">#Use the @ symbol for matrix multiplication</span>
<span class="n">HalphaNx</span><span class="o">=</span><span class="n">ex0</span><span class="o">.</span><span class="n">Op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="nd">@ex0</span><span class="o">.</span><span class="n">Op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">alpha</span>
<span class="n">HbetaNx</span><span class="o">=</span><span class="n">ex0</span><span class="o">.</span><span class="n">Op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="nd">@ex0</span><span class="o">.</span><span class="n">Op</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">beta</span>
<span class="n">U</span><span class="o">=</span><span class="n">R1pU</span><span class="p">(</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">,</span><span class="n">DelCS</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;15Nx&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;15Nx&#39;</span><span class="p">,</span><span class="n">HalphaNx</span><span class="p">,</span><span class="n">HbetaNx</span><span class="p">])</span>

<span class="c1"># Here we extract the decay rates (A little tricky)</span>
<span class="c1"># We need to grab the right element of the powder average ([pwd_avg]),</span>
<span class="c1"># which then still has a very fast decaying, but low weighted term</span>
<span class="c1"># and a slow decay term, which is the relevant one (.min())</span>
<span class="n">rates</span><span class="p">,</span><span class="o">*</span><span class="n">_</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span><span class="o">.</span><span class="n">extract_decay_rates</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">det_num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rates&#39;</span><span class="p">)</span>
<span class="n">Ralpha</span><span class="o">=</span><span class="n">rates</span><span class="p">[</span><span class="n">pwd_index</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">rates</span><span class="p">,</span><span class="o">*</span><span class="n">_</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span><span class="o">.</span><span class="n">extract_decay_rates</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">det_num</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rates&#39;</span><span class="p">)</span>
<span class="n">Rbeta</span><span class="o">=</span><span class="n">rates</span><span class="p">[</span><span class="n">pwd_index</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

<span class="n">rho</span><span class="o">.</span><span class="n">DetProp</span><span class="p">(</span><span class="n">U</span><span class="o">**</span><span class="mi">60</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pwd_index</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">det_num</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;N$_x$&#39;</span><span class="p">)</span>
<span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pwd_index</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">det_num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;H$^\alpha$N$_x$&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pwd_index</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">det_num</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;H$^\beta$N$_x$&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rho</span><span class="o">.</span><span class="n">t_axis</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">rho</span><span class="o">.</span><span class="n">t_axis</span><span class="o">*</span><span class="n">Ralpha</span><span class="p">),</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;MonoExp.(H$^\alpha$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rho</span><span class="o">.</span><span class="n">t_axis</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">rho</span><span class="o">.</span><span class="n">t_axis</span><span class="o">*</span><span class="n">Rbeta</span><span class="p">),</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;MonoExp.(H$^\beta$)&#39;</span><span class="p">)</span>

<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/bbc9e39448b2a18b17ba6e097a4f0647d6a91718c1927a13a7a06124bbee608e.png" src="../_images/bbc9e39448b2a18b17ba6e097a4f0647d6a91718c1927a13a7a06124bbee608e.png" />
</div>
</details>
</div>
<p>Then, we see that for a single orientation, and single state of the <span class="math notranslate nohighlight">\(^1\)</span>H, we do indeed get monoexponential relaxation.</p>
</section>
</section>
<section id="field-strength-and-correlation-time-dependence-of-r-1-rho">
<h3>Field strength and correlation time dependence of <span class="math notranslate nohighlight">\(R_{1\rho}\)</span><a class="headerlink" href="#field-strength-and-correlation-time-dependence-of-r-1-rho" title="Link to this heading">#</a></h3>
<p>When we characterize motion using <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> relaxation, we often acquire a field-strength profile, which can then be used to estimate amplitude and correlation time of motion. We simulate such a profile below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;15Nx&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="s1">&#39;15Nx&#39;</span><span class="p">)</span>
<span class="n">v10</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50000</span><span class="p">,</span><span class="mi">26</span><span class="p">)</span>
<span class="n">v10</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1000</span>
<span class="n">R1p</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">v10</span><span class="p">:</span>
    <span class="n">rho</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">U</span><span class="o">=</span><span class="n">R1pU</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">R1p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rho</span><span class="o">.</span><span class="n">extract_decay_rates</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>
    
<span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v10</span><span class="p">,</span><span class="n">R1p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f64d834146529c3565af4b0c5d1bf77abc20a89f45f2e3f0c54143db1689ad64.png" src="../_images/f64d834146529c3565af4b0c5d1bf77abc20a89f45f2e3f0c54143db1689ad64.png" />
</div>
</div>
<p>To understand how <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> depends timescale of motion, we similarly sweep correlation time and calculate <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> for <span class="math notranslate nohighlight">\(v_1\)</span>=35 kHz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;15Nx&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="s1">&#39;15Nx&#39;</span><span class="p">)</span>
<span class="n">tc0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">hop_angle</span><span class="o">=</span><span class="mi">30</span>
<span class="n">R1p</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">tc</span> <span class="ow">in</span> <span class="n">tc0</span><span class="p">:</span>
    <span class="n">rho</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">U</span><span class="o">=</span><span class="n">R1pU</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="mi">35000</span><span class="p">,</span><span class="n">hop_angle</span><span class="o">=</span><span class="n">hop_angle</span><span class="p">)</span>
    <span class="n">R1p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rho</span><span class="o">.</span><span class="n">extract_decay_rates</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">tc0</span><span class="p">,</span><span class="n">R1p</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;hop angle = </span><span class="si">{</span><span class="n">hop_angle</span><span class="si">}</span><span class="s1"> $^\circ$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d4fd2a8b9a33c906b2f9853c2057356cc2161cc0e4d31a776de0338cde71040f.png" src="../_images/d4fd2a8b9a33c906b2f9853c2057356cc2161cc0e4d31a776de0338cde71040f.png" />
</div>
</div>
<p><strong>Q:</strong> We repeat the above simulation, but adjust the applied field to a much lower field strength.
What changes in the result profile, and why?</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Answer</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">A second peak appears at longer correlation times. The lower applied field increases the contribution to relaxation coming from chemical exchange vs. reorientation motion. Then, a second peak appears around <span class="math notranslate nohighlight">\(\tau_c=1/(2\pi\v_1)\)</span>, where the high, 35 kHz field in the first example suppressed this peak.</p>
</div>
</details><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;15Nx&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="s1">&#39;15Nx&#39;</span><span class="p">)</span>
<span class="n">tc0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">hop_angle</span><span class="o">=</span><span class="mi">30</span>
<span class="n">R1p</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">tc</span> <span class="ow">in</span> <span class="n">tc0</span><span class="p">:</span>
    <span class="n">rho</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">U</span><span class="o">=</span><span class="n">R1pU</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">hop_angle</span><span class="o">=</span><span class="n">hop_angle</span><span class="p">)</span>
    <span class="n">R1p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rho</span><span class="o">.</span><span class="n">extract_decay_rates</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">tc0</span><span class="p">,</span><span class="n">R1p</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;hop angle = </span><span class="si">{</span><span class="n">hop_angle</span><span class="si">}</span><span class="s1"> $^\circ$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8bdeadf002bc31fa0385955c1649ae47e7d853c77b1c32c20fcd3e4f4b8c0d1f.png" src="../_images/8bdeadf002bc31fa0385955c1649ae47e7d853c77b1c32c20fcd3e4f4b8c0d1f.png" />
</div>
</div>
</section>
</section>
<section id="bonus-edit-the-following-code-to-simulate-t-1-relaxation-instead-of-t-1-rho">
<h2>Bonus: Edit the following code to simulate T<span class="math notranslate nohighlight">\(_1\)</span> relaxation instead of T<span class="math notranslate nohighlight">\(_{1\rho}\)</span><a class="headerlink" href="#bonus-edit-the-following-code-to-simulate-t-1-relaxation-instead-of-t-1-rho" title="Link to this heading">#</a></h2>
<p><em>Hints:</em></p>
<ol class="arabic simple">
<li><p><span class="math notranslate nohighlight">\(T_{1\rho}\)</span> can be simulated in the rotating frame, but <span class="math notranslate nohighlight">\(T_1\)</span> requires non-secular terms which only appear in the lab frame</p></li>
<li><p>No applied field is required for <span class="math notranslate nohighlight">\(T_1\)</span> relaxation</p></li>
<li><p><span class="math notranslate nohighlight">\(T_1\)</span> relaxation is sensitive to faster motions than <span class="math notranslate nohighlight">\(T_{1\rho}\)</span> relaxation (~ns)</p></li>
<li><p><span class="math notranslate nohighlight">\(T_1\)</span> addresses z-magnetization,not x-magnetization (you can also use multiple detection matrices in SLEEPY in a list, i.e. use [] brackets, so consider also seeing what <span class="math notranslate nohighlight">\(^1\)</span>H magnetization is doing.</p></li>
<li><p><span class="math notranslate nohighlight">\(T_1\)</span> occurs on a longer timescale  than <span class="math notranslate nohighlight">\(T_{1\rho}\)</span></p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ex0</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">ExpSys</span><span class="p">(</span><span class="n">v0H</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">Nucs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;15N&#39;</span><span class="p">,</span><span class="s1">&#39;1H&#39;</span><span class="p">],</span><span class="n">vr</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span><span class="n">pwdavg</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">n_gamma</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">LF</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ex0</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;dipole&#39;</span><span class="p">,</span><span class="n">i0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">i1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaHN</span><span class="p">)</span>
<span class="n">ex0</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CSA&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaCSA</span><span class="p">,</span><span class="n">euler_d</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">120</span><span class="p">])</span>

<span class="n">ex1</span><span class="o">=</span><span class="n">ex0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ex1</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;dipole&#39;</span><span class="p">,</span><span class="n">i0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">i1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaHN</span><span class="p">,</span><span class="n">euler_d</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">hop_angle</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ex1</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CSA&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaCSA</span><span class="p">,</span><span class="n">euler_d</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">120</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">hop_angle</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>

<span class="n">L</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Liouvillian</span><span class="p">(</span><span class="n">ex0</span><span class="p">,</span><span class="n">ex1</span><span class="p">)</span>
<span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span><span class="n">p1</span><span class="o">=</span><span class="n">p1</span><span class="p">)</span>

<span class="n">seq</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">Sequence</span><span class="p">()</span>
<span class="n">seq</span><span class="o">.</span><span class="n">add_channel</span><span class="p">(</span><span class="s1">&#39;15N&#39;</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">)</span>

<span class="c1"># Initial state of density matrix, detection matrix</span>
<span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;15Nx&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="s1">&#39;15Nx&#39;</span><span class="p">)</span>
<span class="c1"># Propagate for 100 ms (n is number of steps, use int() to get an integer)</span>
<span class="n">rho</span><span class="o">.</span><span class="n">DetProp</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">6000</span><span class="p">)</span> 
<span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;t / ms&#39;, ylabel=&#39;&lt;$^{15}N_x$&gt;&#39;&gt;
</pre></div>
</div>
<img alt="../_images/88d05fbec1da81ebb217e85d7b6444958a770efa82a1fef2894e3aab0f3195c1.png" src="../_images/88d05fbec1da81ebb217e85d7b6444958a770efa82a1fef2894e3aab0f3195c1.png" />
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ex0</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">ExpSys</span><span class="p">(</span><span class="n">v0H</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">Nucs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;15N&#39;</span><span class="p">,</span><span class="s1">&#39;1H&#39;</span><span class="p">],</span><span class="n">vr</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span><span class="n">pwdavg</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">n_gamma</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">LF</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ex0</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;dipole&#39;</span><span class="p">,</span><span class="n">i0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">i1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaHN</span><span class="p">)</span>
<span class="n">ex0</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CSA&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaCSA</span><span class="p">,</span><span class="n">euler_d</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">120</span><span class="p">])</span>

<span class="n">ex1</span><span class="o">=</span><span class="n">ex0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ex1</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;dipole&#39;</span><span class="p">,</span><span class="n">i0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">i1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaHN</span><span class="p">,</span><span class="n">euler_d</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">hop_angle</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ex1</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CSA&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="n">deltaCSA</span><span class="p">,</span><span class="n">euler_d</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">120</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">hop_angle</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>

<span class="n">L</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Liouvillian</span><span class="p">(</span><span class="n">ex0</span><span class="p">,</span><span class="n">ex1</span><span class="p">)</span>
<span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span><span class="n">p1</span><span class="o">=</span><span class="n">p1</span><span class="p">)</span>

<span class="n">seq</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">Sequence</span><span class="p">()</span>

<span class="c1"># Initial state of density matrix, detection matrix</span>
<span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;15Nz&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;15Nz&#39;</span><span class="p">,</span><span class="s1">&#39;1Hz&#39;</span><span class="p">])</span>
<span class="c1"># Propagate for 100 ms (n is number of steps, use int() to get an integer)</span>
<span class="n">rho</span><span class="o">.</span><span class="n">DetProp</span><span class="p">(</span><span class="n">seq</span><span class="o">**</span><span class="mi">1000</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">6000</span><span class="p">)</span> 
<span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;t / s&#39;, ylabel=&#39;&lt;Op&gt;&#39;&gt;
</pre></div>
</div>
<img alt="../_images/1985a5af54577f00e745f2c0391136aed75d465fcdb1e1d490e964b117d03840.png" src="../_images/1985a5af54577f00e745f2c0391136aed75d465fcdb1e1d490e964b117d03840.png" />
</div>
</details>
</div>
</section>
<section id="part-2-fitting-bloch-mcconnell-relaxation-dispersion-data">
<h2>Part 2: Fitting Bloch-McConnell Relaxation Dispersion Data<a class="headerlink" href="#part-2-fitting-bloch-mcconnell-relaxation-dispersion-data" title="Link to this heading">#</a></h2>
<p>The above discussion has dealt with the simulation of dispersion data: where we have a model for our system, and would like to predict the dispersion profiles arising from this. Now, we consider the inverse problem.</p>
<p>Experimentally, we may record relaxation dispersion profiles. However, these dispersion profiles do not directly tell us much about our system. For this, we’d like some way of being able to model these. Firstly, some experimental considerations:</p>
<ul class="simple">
<li><p>Strong anisotropic interactions in the solid state restrict our lowest <span class="math notranslate nohighlight">\(\nu_1\)</span> RF field strength to <span class="math notranslate nohighlight">\(\approx\)</span> 2 kHz.</p></li>
<li><p>Proton-driven spin diffusion requires that we consider the MAS frequencies and isotopic labelling we apply.</p></li>
<li><p>We need to consider possible recoupling conditions which may lead to artefactual elevation in BMRD profiles - for this reason, it is important to consider decoupling the <span class="math notranslate nohighlight">\(^{1}\)</span>H channel.</p></li>
</ul>
<p>Before we move on to analysing the dispersion curves, it may be useful to play around with the dispersion model you’ve been using above to see how the form of this curve varies with the difference in chemical shift, populations, and correlation times.</p>
<section id="formulas-for-relaxation-behavior">
<h3>Formulas for relaxation behavior<a class="headerlink" href="#formulas-for-relaxation-behavior" title="Link to this heading">#</a></h3>
<p>The relaxation that was simulated above can be calculated using formulas. For reorientational motion, we typically calculate the orientationally-averaged relaxation rate constant. For exchange, there is no orientation dependence, so the formula simply returns the relaxation rate constant.</p>
<p>Miloushev and Palmer<span class="math notranslate nohighlight">\(^1\)</span> provide us with the relevant formula for predicting <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> relaxation due to chemical exchange.</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
R_{1\rho}^{ex}=\frac{\sin^2\beta_ep_1p_2\Delta\omega_{12}^2k_{ex}}{\frac{\omega_{e1}^2\omega_{e2}^2}{\omega_e^2}+k_{ex}^2-\sin^2\beta_ep_1p_2\Delta\omega_{12}^2\left(1+\frac{2k_{ex}^2(p_1\omega_{e1}^2+p_2\omega_{e2}^2)}{\omega_{e1}^2\omega_{e2}^2+\omega_e^2k_{ex}^2}\right)}
\end{equation}
\]</div>
<p>with the following definitions:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
k_{ex}&amp;=&amp;k_{1\rightarrow2}+k_{2\rightarrow1} \\
\Omega&amp;=&amp;p_1\Omega_1+p_2\Omega_2 \\
\Delta\omega_{12}&amp;=&amp;\Omega_1-\Omega_2 \\
\omega_e^2&amp;=&amp;\omega_1^2+\Omega^2 \\
\omega_{e1}^2&amp;=&amp;\omega_1^2+\Omega_1^2 \\
\omega_{e2}^2&amp;=&amp;\omega_1^2+\Omega_2^2 \\
\sin^2\beta_e&amp;=&amp;\frac{\omega_1^2}{\omega_1^2+\Omega^2}
\end{eqnarray}
\end{split}\]</div>
<p>Although we do not use it below, it is also important to note that Kurbanov et al.<span class="math notranslate nohighlight">\(^2\)</span> provide the formula for the orientationally-averaged <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> relaxation rate due to reorientational motion of a dipolar coupling and chemical shift anisotropy.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
R_1&amp;=&amp;\left(\frac{\delta_{IS}}4\right)^2\left(J(\omega_I-\omega_S)+3J(\omega_I)+6J(\omega_I+\omega_S)\right)+\frac13(\omega_I\Delta\sigma)^2J(\omega_I) \\
R_{1\rho}&amp;=&amp;\frac12R_1+\left(\frac{\delta_{IS}}4\right)^2\left(3J(\omega_S)+\frac13J(\omega_1-2\omega_r)+\frac23J(\omega_1-\omega_r)+\frac23J(\omega_1+\omega_r)+\frac13J(\omega+2\omega_r)\right) \\
&amp;+&amp;\frac2{27}(\omega_I\Delta\sigma)^2\left(\frac12J(\omega_1-2\omega_r)+J(\omega_1-\omega_r)+J(\omega_1+\omega_r)+\frac12J(\omega_1+2\omega_r)\right)
\end{eqnarray}
\end{split}\]</div>
<p>For a single correlation time and two-site hopping motion, the spectral density becomes</p>
<div class="math notranslate nohighlight">
\[
\begin{equation}
J(\omega)=\frac25(1-S^2)\frac{\tau_c}{1+(\omega\tau_c)^2}
\end{equation}
\]</div>
<p>with <span class="math notranslate nohighlight">\(S^2=1+3p_1p_2(\cos^2{(\theta)}-1)\)</span>, where <span class="math notranslate nohighlight">\(\theta\)</span> is the hop angle, and <span class="math notranslate nohighlight">\(\tau_c=1/(k_{1\rightarrow2}+k_{2\rightarrow1})\)</span></p>
<p>[1] V.Z. Miloushev, A.G. Palmer. <a class="reference external" href="https://doi.org/10.1016/j.jmr.2005.07.023"><em>J. Magn. Reson.</em></a>, <strong>2015</strong>, 177, 221-227</p>
<p>[2] R. Kurbanov, T. Zinkevich, A. Krushelnitsky. <a class="reference external" href="https://doi.org/10.1063/1.3658383"><em>J. Chem. Phys</em></a>, <strong>2011</strong>, 135, 184104 (1-9)</p>
<p>Below, we introduce functions for calculating the above formulas. Note that the functions are setup to take a Liouvillian or Propagator from SLEEPY as input and will extract the desired parameters automatically. What is returned is R1p as a function of a sweep of the field strength (v1,R1p returned).</p>
</section>
<section id="simulate-a-dataset">
<h3>Simulate a dataset<a class="headerlink" href="#simulate-a-dataset" title="Link to this heading">#</a></h3>
<p>Below, we use SLEEPY to simulate a data set, which we will then analyze using the above formulas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;15Nx&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="s1">&#39;15Nx&#39;</span><span class="p">)</span>
<span class="n">v10</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">R1p</span><span class="o">=</span><span class="p">[]</span>
<span class="c1"># For each spin lock field strength we calculate the propagator and determine the relaxation rate</span>
<span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">v10</span><span class="p">:</span>
    <span class="n">rho</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">U</span><span class="o">=</span><span class="n">R1pU</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span><span class="n">hop_angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">DelCS</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">)</span>
    <span class="n">R1p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rho</span><span class="o">.</span><span class="n">extract_decay_rates</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>
<span class="n">R1p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">R1p</span><span class="p">)</span>
<span class="n">R1p</span><span class="o">+=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R1p</span><span class="p">))</span><span class="o">*</span><span class="n">R1p</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">*</span><span class="mf">.15</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v10</span><span class="p">,</span> <span class="n">R1p</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">nu_1$ / Hz&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$R_{1</span><span class="se">\\</span><span class="s2">rho}$ / s$^{-1}$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/97dda1fbeb9307f61d5db3ff34d84b6454bf0b0eb96e82382f6a3bdad0dab007.png" src="../_images/97dda1fbeb9307f61d5db3ff34d84b6454bf0b0eb96e82382f6a3bdad0dab007.png" />
</div>
</div>
<p>Below, we introduce a function to calculate <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> resulting from chemical exchange, and use it to fit the above dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">R1p_ex</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">DelOmega</span><span class="p">,</span> <span class="n">kex</span><span class="p">):</span> <span class="c1"># equivalent to R1p_ex above, parameterised for curve fitting.</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">p1</span>
    <span class="n">Omega1</span> <span class="o">=</span> <span class="o">-</span><span class="n">DelOmega</span><span class="o">*</span><span class="n">p2</span>
    <span class="n">Omega2</span> <span class="o">=</span> <span class="n">DelOmega</span><span class="o">*</span><span class="n">p1</span>
    <span class="n">Omega</span><span class="o">=</span><span class="n">p1</span><span class="o">*</span><span class="n">Omega1</span><span class="o">+</span><span class="n">p2</span><span class="o">*</span><span class="n">Omega2</span>
    <span class="n">DelOmega</span><span class="o">=</span><span class="n">Omega1</span><span class="o">-</span><span class="n">Omega2</span>
    <span class="n">omega1</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">v1</span>
    <span class="n">omega_e</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">omega1</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">omega_e1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">omega1</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Omega1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">omega_e2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">omega1</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Omega2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">sin2Beta</span><span class="o">=</span><span class="n">omega1</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">omega1</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">f1</span><span class="o">=</span><span class="n">omega_e1</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">omega_e2</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">omega_e</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">f2</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">kex</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">p1</span><span class="o">*</span><span class="n">omega_e1</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">p2</span><span class="o">*</span><span class="n">omega_e2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">omega_e1</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">omega_e2</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">omega_e</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">kex</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">R1p</span><span class="o">=</span><span class="n">sin2Beta</span><span class="o">*</span><span class="n">p1</span><span class="o">*</span><span class="n">p2</span><span class="o">*</span><span class="n">DelOmega</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">kex</span><span class="o">/</span><span class="p">(</span><span class="n">f1</span><span class="o">+</span><span class="n">kex</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">sin2Beta</span><span class="o">*</span><span class="n">p1</span><span class="o">*</span><span class="n">p2</span><span class="o">*</span><span class="n">DelOmega</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">f2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">R1p</span>

<span class="c1"># We use scipy optimize&#39;s curve_fit function to fit the model. If we had experimental uncertainties,</span>
<span class="c1"># these could be included using the &#39;sigma&#39; and &#39;absolute_sigma&#39; parameters of this function.</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">R1p_ex</span><span class="p">,</span> <span class="n">v10</span><span class="p">,</span> <span class="n">R1p</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)],</span> <span class="n">maxfev</span><span class="o">=</span><span class="mi">20000</span><span class="p">)</span>
<span class="n">perr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov</span><span class="p">))</span> <span class="c1"># take standard deviation as uncertainty from variances in covariance matrix</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p1 = </span><span class="si">%0.2f</span><span class="s2"> +- </span><span class="si">%0.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">perr</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dW = </span><span class="si">%0.2f</span><span class="s2"> +- </span><span class="si">%0.2f</span><span class="s2"> ppm&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">60</span><span class="p">),</span> <span class="n">perr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">60</span><span class="p">)))</span> <span class="c1"># divide to convert from rad/s to ppm</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;kex = </span><span class="si">%0.2f</span><span class="s2"> +- </span><span class="si">%0.2f</span><span class="s2"> s-1&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">perr</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v10</span><span class="p">,</span> <span class="n">R1p</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v10</span><span class="p">,</span> <span class="n">R1p_ex</span><span class="p">(</span><span class="n">v10</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">nu_1$ / Hz&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$R_{1</span><span class="se">\\</span><span class="s2">rho}$ / s$^{-1}$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>p1 = 0.19 +- 422.77
dW = 6.58 +- 5963.58 ppm
kex = 9890.29 +- 558205.75 s-1
</pre></div>
</div>
<img alt="../_images/9c2497a0474d7a05386baf411224448c785a732feae1336780aed89b78d15410.png" src="../_images/9c2497a0474d7a05386baf411224448c785a732feae1336780aed89b78d15410.png" />
</div>
</div>
<p>Huh - odd. It appears that we have a really well fit curve, but the uncertainties in the populations (p1) and chemical shift difference (dW) are massive! Lets try to investigate this - we’ll plot the root sum squared residual as a function of these two parameters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">sqres</span><span class="p">(</span><span class="n">dw</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="c1"># calculate the root sum squared residual as a function of dW and population</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">R1p</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">R1p_ex</span><span class="p">(</span><span class="n">v10</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">dw</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">dW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="c1"># ppm</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">DW</span><span class="p">,</span> <span class="n">P1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">dW</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
<span class="n">residual</span> <span class="o">=</span> <span class="n">sqres</span><span class="p">(</span><span class="n">DW</span><span class="p">,</span> <span class="n">P1</span><span class="p">)</span>
<span class="n">clevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.05</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">DW</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">residual</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">clevels</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">delta </span><span class="se">\\</span><span class="s2">omega$ / ppm&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$p_</span><span class="si">{1}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/79d7e65ecc9ab395906bbfc8a82a88b646b69233ba498b41493f3078c80b4c0a.png" src="../_images/79d7e65ecc9ab395906bbfc8a82a88b646b69233ba498b41493f3078c80b4c0a.png" />
</div>
</div>
<p><strong>Q:</strong> From the plot above, can you explain why the errors for <span class="math notranslate nohighlight">\(p_1\)</span> and <span class="math notranslate nohighlight">\(\delta\omega\)</span> are so high?</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">Answer</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">The minimum error is not found at a single point, but rather along a contour, so neither <span class="math notranslate nohighlight">\(\delta\omega\)</span>, nor <span class="math notranslate nohighlight">\(p_1\)</span> can be precisely defined.</p>
<p class="sd-card-text">This is because our exchange rate is greater than the difference in chemical shift between the exchanging sites, we are in what is termed the ‘fast exchange limit’. In this case, the Miloushev-Palmer equation is highly degenerate in populations and chemical shift differences: It is not possible to break the degeneracy in this case.</p>
<p class="sd-card-text">But does this always need to be the case?</p>
</div>
</details><p>To understand which timescales we are sensitive to, we can consider the difference in <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> at 2 and 10 kHz. If we see a large, measurable difference, we can therefore measure exchange processes with this rate. If not, we are unable to distinguish these.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tau_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">dR1p</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">tau_c</span><span class="p">:</span>
    <span class="n">rho</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">U_1kHz</span> <span class="o">=</span> <span class="n">R1pU</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span><span class="n">hop_angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">DelCS</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">R1p_1kHz</span> <span class="o">=</span> <span class="n">rho</span><span class="o">.</span><span class="n">extract_decay_rates</span><span class="p">(</span><span class="n">U_1kHz</span><span class="p">)</span>
    <span class="n">rho</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">U_10kHz</span> <span class="o">=</span> <span class="n">R1pU</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="n">tau</span><span class="p">,</span><span class="n">hop_angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">DelCS</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">R1p_10kHz</span> <span class="o">=</span> <span class="n">rho</span><span class="o">.</span><span class="n">extract_decay_rates</span><span class="p">(</span><span class="n">U_10kHz</span><span class="p">)</span>
    <span class="n">dR1p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R1p_1kHz</span> <span class="o">-</span> <span class="n">R1p_10kHz</span><span class="p">)</span>
    
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tau_c</span><span class="p">,</span> <span class="n">dR1p</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">tau_c$ / s&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">Delta R_{1</span><span class="se">\\</span><span class="s2">rho}$ / s$^{-1}$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/369a9840b292b4a8c460768909108553c90bb2b8be9e637b57af6fc3bc7d86b8.png" src="../_images/369a9840b292b4a8c460768909108553c90bb2b8be9e637b57af6fc3bc7d86b8.png" />
</div>
</div>
<p>As can be seen, because of the limitations of our experiment we are limited to correlation times on the order of 10<span class="math notranslate nohighlight">\(^{-5}\)</span> s to 10<span class="math notranslate nohighlight">\(^{-3}\)</span> s - these correspond to exchange rates from 1000 s<span class="math notranslate nohighlight">\(^{-1}\)</span> to 100,000 s<span class="math notranslate nohighlight">\(^{-1}\)</span>. Consequently, for <span class="math notranslate nohighlight">\(^{15}\)</span>N, unless <span class="math notranslate nohighlight">\(\delta \omega &gt; 16.7\)</span> ppm, we are in fast exchange and cannot separate populations and chemical shifts.</p>
<p>As a further issue, because of this limitation it is also not possible for us to know that we are in two site exchange. As a result, we should not fit a two site exchange model.</p>
<p>What is typically done instead is to assume a single process, and fit a scaling amplitude:</p>
<p><span class="math notranslate nohighlight">\(R_{1\rho} = \frac{\phi_{ex} k_{ex}}{\omega_{1}^{2} + k_{ex}^{2}}\)</span>,</p>
<p>where (for two-site exchange), <span class="math notranslate nohighlight">\(\phi = p_1 p_2 (\Delta \omega^2)\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">R1p_ex</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">phiex</span><span class="p">,</span> <span class="n">kex</span><span class="p">):</span>
    <span class="n">omega1</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">v1</span>
    <span class="n">Omega</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># transmitter offset</span>
    <span class="n">omega_e</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">omega1</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">sin2Beta</span><span class="o">=</span><span class="n">omega1</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">omega1</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">R1p</span><span class="o">=</span><span class="n">sin2Beta</span><span class="o">*</span><span class="n">phiex</span><span class="o">*</span><span class="n">kex</span><span class="o">/</span><span class="p">(</span><span class="n">omega_e</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">kex</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">R1p</span>

<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">R1p_ex</span><span class="p">,</span> <span class="n">v10</span><span class="p">,</span> <span class="n">R1p</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)],</span> <span class="n">maxfev</span><span class="o">=</span><span class="mi">20000</span><span class="p">)</span>
<span class="n">perr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;phiex = </span><span class="si">%0.2f</span><span class="s2"> +- </span><span class="si">%0.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">perr</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;kex = </span><span class="si">%0.2f</span><span class="s2"> +- </span><span class="si">%0.2f</span><span class="s2"> s-1&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">perr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">dv</span><span class="p">,</span><span class="n">dve</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">perr</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;For p1=0.5, dW=</span><span class="si">{</span><span class="n">dv</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">+-</span><span class="si">{</span><span class="n">dve</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v10</span><span class="p">,</span> <span class="n">R1p</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v10</span><span class="p">,</span> <span class="n">R1p_ex</span><span class="p">(</span><span class="n">v10</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">nu_1$ / Hz&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$R_{1</span><span class="se">\\</span><span class="s2">rho}$ / s$^{-1}$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>phiex = 916941.31 +- 16836.96
kex = 10012.90 +- 406.07 s-1
For p1=0.5, dv=5.08+-0.69
</pre></div>
</div>
<img alt="../_images/1f8cb5c07dc81c0a25bc3ff381764baa6c4ea0e5bf6790a0b20e3471bf740e4c.png" src="../_images/1f8cb5c07dc81c0a25bc3ff381764baa6c4ea0e5bf6790a0b20e3471bf740e4c.png" />
</div>
</div>
<p>It appears again that we have a good fit! But let’s double check the parameters to ensure this isn’t a degenerate fit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Appears we have a good fit! But let&#39;s check our parameter degeneracy</span>

<span class="k">def</span><span class="w"> </span><span class="nf">sqres</span><span class="p">(</span><span class="n">phiex</span><span class="p">,</span> <span class="n">kex</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">R1p</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">R1p_ex</span><span class="p">(</span><span class="n">v10</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">phiex</span><span class="p">,</span> <span class="n">kex</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2e6</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">kex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">PHI</span><span class="p">,</span> <span class="n">KEX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">kex</span><span class="p">)</span>
<span class="n">residual</span> <span class="o">=</span> <span class="n">sqres</span><span class="p">(</span><span class="n">PHI</span><span class="p">,</span> <span class="n">KEX</span><span class="p">)</span>
<span class="n">clevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.02</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">PHI</span><span class="p">,</span> <span class="n">KEX</span><span class="p">,</span> <span class="n">residual</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">clevels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cb</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">phi_</span><span class="si">{ex}</span><span class="s2">$ / s$^{-2}$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$k_</span><span class="si">{ex}</span><span class="s2">$ / s$^{-1}$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4e31b3dc35049f141c144db5e1f31821b90980e0cde47218c51a37713e0c0d6a.png" src="../_images/4e31b3dc35049f141c144db5e1f31821b90980e0cde47218c51a37713e0c0d6a.png" />
</div>
</div>
<p>Then, the parameter <span class="math notranslate nohighlight">\(\phi_{ex}\)</span> becomes well defined, although its interpretation is ambiguous. If we assume two-site exchange, <span class="math notranslate nohighlight">\(\phi_{ex}=p_1p_2(\Delta\omega)^2\)</span>, we can place a lower bound on <span class="math notranslate nohighlight">\(\Delta\omega\)</span>, by assuming <span class="math notranslate nohighlight">\(p_1=0.5\)</span>, but for lower values of <span class="math notranslate nohighlight">\(p_1\)</span>, <span class="math notranslate nohighlight">\(\Delta\omega\)</span> must be larger. Furthermore, it is difficult to know for sure that we have a two-site hopping motion, which further confounds our interpretation of the parameter (but don’t despair, a timescale and a lower bound for <span class="math notranslate nohighlight">\(\Delta\omega\)</span> is a lot of information, especially if we have this information for multiple residues or another source of dynamics information)</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./ssNMR2025"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ssNMR2025.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><font color=#5d6d7e> Solid-State NMR 2025 </font></p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1-simulating-r-1-rho">Part 1: Simulating <span class="math notranslate nohighlight">\(R_{1\rho}\)</span></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#python-setup">Python Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-setup">Simulation Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">Parameters</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#build-the-experimental-systems">Build the experimental systems</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#couple-systems-into-a-liouvillian-generate-a-pulse-sequence">Couple systems into a Liouvillian, generate a pulse sequence</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-density-matrix-propagate">Create a density matrix, propagate</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-results">Plot the results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-functions-for-faster-setup">Create functions for faster setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-relaxation-for-various-conditions">Examine relaxation for various conditions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sources-of-multiexpontiality">Sources of multiexpontiality</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#field-strength-and-correlation-time-dependence-of-r-1-rho">Field strength and correlation time dependence of <span class="math notranslate nohighlight">\(R_{1\rho}\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bonus-edit-the-following-code-to-simulate-t-1-relaxation-instead-of-t-1-rho">Bonus: Edit the following code to simulate T<span class="math notranslate nohighlight">\(_1\)</span> relaxation instead of T<span class="math notranslate nohighlight">\(_{1\rho}\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2-fitting-bloch-mcconnell-relaxation-dispersion-data">Part 2: Fitting Bloch-McConnell Relaxation Dispersion Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#formulas-for-relaxation-behavior">Formulas for relaxation behavior</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulate-a-dataset">Simulate a dataset</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Albert Smith
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>