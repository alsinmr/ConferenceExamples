
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Chemical Exchange &#8212; Conference Tutorials</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'GNMR2025/Exchange';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Calculating NMR Parameters from MD Simulations 1: S\(^2\) and C(t)" href="MD2NMR.html" />
    <link rel="prev" title="G-NMR 2025" href="GNMR2025.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Conference Tutorials</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Conference Tutorials
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Software.html">Software</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="GNMR2025.html"><font color="#5d6d7e"> G-NMR 2025 </font></a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#"><font color="#2e86c1"> Chemical Exchange </font></a></li>
<li class="toctree-l2"><a class="reference internal" href="MD2NMR.html"><font color="#2e86c1"> Calculating NMR Parameters from MD Simulations 1: S<span class="math notranslate nohighlight">\(^2\)</span> and C(t) </font></a></li>
<li class="toctree-l2"><a class="reference internal" href="MD2NMR_fitting.html"><font color="#2e86c1"> Calculating NMR Parameters from MD Simulations 2: Calculating Relaxation </font></a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/alsinmr/ConferenceExamples/blob/master/JupyterBook/GNMR2025/Exchange.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/alsinmr/ConferenceExamples" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/alsinmr/ConferenceExamples/issues/new?title=Issue%20on%20page%20%2FGNMR2025/Exchange.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/GNMR2025/Exchange.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1><font color=#2e86c1> Chemical Exchange </font></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-functions">Simulation functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chemical-exchange-in-1d">Chemical Exchange in 1D</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-1">Exercise 1.1:</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#some-hints-on-2x2-exchange-matrices">Some hints on 2x2 exchange matrices</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-2">Exercise 1.2:</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1">Part 1</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2">Part 2</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-3">Part 3</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-4">Part 4</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-3">Exercise 1.3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-4">Exercise 1.4</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chemical-exchange-in-2d">Chemical Exchange in 2D</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-1">Exercise 2.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-2">Exercise 2.2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-3">Exercise 2.3</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#r-1-rho-and-cpmg"><span class="math notranslate nohighlight">\(R_{1\rho}\)</span> and CPMG</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-1">Exercise 3.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-2">Exercise 3.2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cest">CEST</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-1">Exercise 4.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-2">Exercise 4.2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#matching-game">Matching Game</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="chemical-exchange">
<h1><font color=#2e86c1> Chemical Exchange </font><a class="headerlink" href="#chemical-exchange" title="Link to this heading">#</a></h1>
<p><a href="https://githubtocolab.com/alsinmr/ConferenceExamples/blob/master/JupyterBook/GNMR2025/Exchange_Colab.ipynb" target="_blank"><img src="https://colab.research.google.com/assets/colab-badge.svg"></a></p>
<p>Chemical exchange is an important phenomenon in magnetic resonance, where a chemical or physical change in a molecule gives rise to a modulation in the chemical shift for a given spin. Depending on the rate of exchange between two or more chemical shifts, we may observe the effects of exchange using a number of different experiments.</p>
<p>The following tutorial will introduce this concept and investigate effects of various parameters on several different experiments. We’ll use SLEEPY <a class="reference external" href="http://sleepy-nmr.org">http://sleepy-nmr.org</a> to support our investigations, so take some time to experiment with the software as you go.</p>
<p><img alt="pulse sequences" src="../_images/sequences.png" /></p>
<p>The basic formulas for calculating the influence of exchange on a 1D spectrum are the Bloch-McConnell equations:</p>
<p>H.M. McConnell. <a class="reference external" href="https://doi.org/10.1063/1.1744152"><em>J. Chem. Phys.</em></a>, <strong>1958</strong>, 28, 430-431.</p>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">SLEEPY</span> <span class="k">as</span> <span class="nn">sl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">sl</span><span class="o">.</span><span class="n">Defaults</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="simulation-functions">
<h2>Simulation functions<a class="headerlink" href="#simulation-functions" title="Link to this heading">#</a></h2>
<p>The hidden cell below (visibile in Colab) defines 5 different experiments that we’ll apply in this tutorial:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">OneD</span></code> : Simple, 1D spectrum</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EXSY</span></code> : Exchange Spectroscopy experiment. Set buildup=False to see a 2D spectrum. Set buildup=True to see time-dependent buildup of the peaks over multiple EXSY experiments</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CEST</span></code> : Chemical Exchange Saturation Transfer experiment</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">R1p</span></code>  : <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> relaxation (relaxation under a spin-lock). 7 field strengths applied</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CPMG</span></code> : Carr-Purcell-Meiboom-Gill pulse train. 7 frequencies applied (matches the field strengths of <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> experiment</p></li>
</ul>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">OneD</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">seq</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">Sequence</span><span class="p">(</span><span class="n">Dt</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">4000</span><span class="p">)</span>

    <span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;S0x&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="s1">&#39;S0p&#39;</span><span class="p">)</span>
    <span class="n">rho</span><span class="o">.</span><span class="n">DetProp</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">FT</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>
    
<span class="k">def</span> <span class="nf">EXSY</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">buildup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">dly0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dly</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="k">if</span> <span class="n">buildup</span> <span class="k">else</span> <span class="p">[</span><span class="n">dly</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">buildup</span><span class="p">:</span><span class="n">I00</span><span class="p">,</span><span class="n">I01</span><span class="p">,</span><span class="n">I10</span><span class="p">,</span><span class="n">I11</span><span class="o">=</span><span class="p">[],[],[],[]</span>
    
    <span class="n">p1</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    
    
    <span class="n">seq</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">Sequence</span><span class="p">(</span><span class="n">Dt</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2000</span><span class="p">)</span>
    <span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;S0x&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="s1">&#39;S0p&#39;</span><span class="p">)</span>
    <span class="n">v1</span><span class="o">=</span><span class="mi">50000</span>
    <span class="n">tpi2</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="mi">4</span>
    
    <span class="k">for</span> <span class="n">dly</span> <span class="ow">in</span> <span class="n">dly0</span><span class="p">:</span>
        <span class="n">t</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">tpi2</span><span class="p">,</span><span class="n">dly</span><span class="o">+</span><span class="n">tpi2</span><span class="p">,</span><span class="n">dly</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">tpi2</span><span class="p">]</span>
        <span class="n">seqX</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">Sequence</span><span class="p">()</span><span class="o">.</span><span class="n">add_channel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="p">[</span><span class="n">v1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">v1</span><span class="p">],</span><span class="n">phase</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">seqY</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">Sequence</span><span class="p">()</span><span class="o">.</span><span class="n">add_channel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="p">[</span><span class="n">v1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">v1</span><span class="p">],</span><span class="n">phase</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">twoD</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">TwoD_Builder</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span><span class="n">seq_dir</span><span class="o">=</span><span class="n">seq</span><span class="p">,</span><span class="n">seq_in</span><span class="o">=</span><span class="n">seq</span><span class="p">,</span><span class="n">seq_trX</span><span class="o">=</span><span class="n">seqX</span><span class="p">,</span><span class="n">seq_trY</span><span class="o">=</span><span class="n">seqY</span><span class="p">)</span>
        <span class="n">twoD</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span><span class="o">.</span><span class="n">proc</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">buildup</span><span class="p">:</span>
            <span class="n">I11</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">twoD</span><span class="o">.</span><span class="n">Sreal</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="mi">64</span><span class="p">][:,:</span><span class="mi">32</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="n">I10</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">twoD</span><span class="o">.</span><span class="n">Sreal</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="mi">64</span><span class="p">][:,</span><span class="mi">32</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="n">I01</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">twoD</span><span class="o">.</span><span class="n">Sreal</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="mi">64</span><span class="p">:][:,:</span><span class="mi">32</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="n">I00</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">twoD</span><span class="o">.</span><span class="n">Sreal</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="mi">64</span><span class="p">:][:,</span><span class="mi">32</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    
    <span class="k">if</span> <span class="n">buildup</span><span class="p">:</span>
        <span class="n">I00</span><span class="p">,</span><span class="n">I01</span><span class="p">,</span><span class="n">I10</span><span class="p">,</span><span class="n">I11</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="o">/</span><span class="n">I00</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">p1</span> <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="p">[</span><span class="n">I00</span><span class="p">,</span><span class="n">I01</span><span class="p">,</span><span class="n">I10</span><span class="p">,</span><span class="n">I11</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dly0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span><span class="n">I00</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$0\rightarrow 0$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dly0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span><span class="n">I01</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$0\rightarrow 1$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dly0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span><span class="n">I10</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$1\rightarrow 0$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dly0</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span><span class="n">I11</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$1\rightarrow 1$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t / ms&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">twoD</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">([</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">twoD</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>    
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">twoD</span><span class="o">.</span><span class="n">Sreal</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1.2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ax</span>

<span class="k">def</span> <span class="nf">CEST</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;S0z&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="s1">&#39;S0p&#39;</span><span class="p">)</span>
    <span class="n">seq</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">Sequence</span><span class="p">(</span><span class="n">Dt</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">2000</span><span class="p">)</span>
    <span class="n">t</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">dly</span><span class="p">,</span><span class="n">dly</span><span class="o">+</span><span class="mf">2.5e-6</span><span class="p">]</span>
    <span class="n">sat</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">Sequence</span><span class="p">()</span><span class="o">.</span><span class="n">add_channel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="p">[</span><span class="n">v1</span><span class="p">,</span><span class="mf">1e5</span><span class="p">],</span><span class="n">phase</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">rho</span><span class="p">,</span><span class="n">seq</span><span class="p">,</span><span class="n">sat</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">ReducedSetup</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span><span class="n">sat</span><span class="p">)</span>

    <span class="n">I</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">voff0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2000</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">voff</span> <span class="ow">in</span> <span class="n">voff0</span><span class="p">:</span>
        <span class="n">rho</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">t</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">dly</span><span class="p">,</span><span class="n">dly</span><span class="o">+</span><span class="mf">2.5e-6</span><span class="p">]</span>
        <span class="n">sat</span><span class="o">.</span><span class="n">add_channel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="p">[</span><span class="n">v1</span><span class="p">,</span><span class="mf">1e5</span><span class="p">],</span><span class="n">voff</span><span class="o">=</span><span class="p">[</span><span class="n">voff</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">phase</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
        <span class="p">(</span><span class="n">sat</span><span class="o">*</span><span class="n">rho</span><span class="p">)</span><span class="o">.</span><span class="n">DetProp</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
        <span class="n">I</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rho</span><span class="o">.</span><span class="n">FT</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">125</span><span class="p">:</span><span class="mi">225</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">voff0</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span><span class="n">I</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\nu$ / kHz&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">voff0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span><span class="n">voff0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">1e3</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ax</span>

<span class="k">def</span> <span class="nf">R1p</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">v10</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">40000</span><span class="p">),</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;S0x&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="s1">&#39;S0p&#39;</span><span class="p">)</span>
    <span class="n">leg</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">v10</span><span class="p">:</span>
        <span class="n">seq</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">Sequence</span><span class="p">(</span><span class="n">Dt</span><span class="o">=</span><span class="n">dly</span><span class="o">/</span><span class="mi">500</span><span class="p">)</span><span class="o">.</span><span class="n">add_channel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="p">)</span>
        <span class="n">rho</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">rho</span><span class="o">.</span><span class="n">DetProp</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">leg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">v1</span><span class="o">/</span><span class="mf">1e3</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> kHz&#39;</span><span class="p">)</span>
    <span class="n">sc</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">expsys</span><span class="o">.</span><span class="n">Peq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span> <span class="k">if</span> <span class="n">L</span><span class="o">.</span><span class="n">Peq</span> <span class="k">else</span> <span class="mf">0.5</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="o">*</span><span class="n">sc</span><span class="p">,</span><span class="n">sc</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">leg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>

<span class="k">def</span> <span class="nf">CPMG</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">f0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">40000</span><span class="p">),</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">v1</span><span class="o">=</span><span class="mi">50000</span>
    <span class="n">pi2</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="mi">4</span>
    <span class="n">dly0</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">f0</span><span class="o">/</span><span class="mi">4</span>
    <span class="n">n0</span><span class="o">=</span><span class="p">(</span><span class="n">dly</span><span class="o">/</span><span class="n">dly0</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;S0x&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="s1">&#39;S0p&#39;</span><span class="p">)</span>
    <span class="n">leg</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span><span class="p">,</span><span class="n">dly</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span><span class="n">dly0</span><span class="p">,</span><span class="n">n0</span><span class="p">):</span>
        <span class="n">t</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">dly</span><span class="o">-</span><span class="n">pi2</span><span class="p">,</span><span class="n">dly</span><span class="o">+</span><span class="n">pi2</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n">dly</span><span class="o">-</span><span class="n">pi2</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n">dly</span><span class="o">+</span><span class="n">pi2</span><span class="p">,</span><span class="mi">5</span><span class="o">*</span><span class="n">dly</span><span class="o">-</span><span class="n">pi2</span><span class="p">,</span><span class="mi">5</span><span class="o">*</span><span class="n">dly</span><span class="o">+</span><span class="n">pi2</span><span class="p">,</span><span class="mi">7</span><span class="o">*</span><span class="n">dly</span><span class="o">-</span><span class="n">pi2</span><span class="p">,</span><span class="mi">7</span><span class="o">*</span><span class="n">dly</span><span class="o">+</span><span class="n">pi2</span><span class="p">,</span><span class="mi">8</span><span class="o">*</span><span class="n">dly</span><span class="p">]</span>
        <span class="n">seq</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">Sequence</span><span class="p">()</span><span class="o">.</span><span class="n">add_channel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span><span class="n">phase</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">rho</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">rho</span><span class="o">.</span><span class="n">DetProp</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">leg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">f</span><span class="o">/</span><span class="mf">1e3</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> kHz&#39;</span><span class="p">)</span>
    <span class="n">sc</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">expsys</span><span class="o">.</span><span class="n">Peq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span> <span class="k">if</span> <span class="n">L</span><span class="o">.</span><span class="n">Peq</span> <span class="k">else</span> <span class="mf">0.5</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="o">*</span><span class="n">sc</span><span class="p">,</span><span class="n">sc</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">leg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>

<span class="n">pars</span><span class="o">=</span><span class="p">[(</span><span class="mf">.01</span><span class="p">,</span><span class="mf">.95</span><span class="p">),(</span><span class="mf">1e-5</span><span class="p">,</span><span class="mf">0.75</span><span class="p">),(</span><span class="mf">.1</span><span class="p">,</span><span class="mf">0.35</span><span class="p">),(</span><span class="mf">1e-3</span><span class="p">,</span><span class="mf">.6</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="chemical-exchange-in-1d">
<h2>Chemical Exchange in 1D<a class="headerlink" href="#chemical-exchange-in-1d" title="Link to this heading">#</a></h2>
<p>The most basic experiment for observing chemical exchange is a simple 1D experiment, where we exchange between chemical shifts. In this experiment, evolution of a coherence under the chemical shift depends on the state of the system, for example:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\frac{d}{dt}\langle\hat{S}_1^+\rangle&amp;=&amp;-i\Omega_1\langle\hat{S}_1^+\rangle \:\mathrm{ : state\:1} \\
\frac{d}{dt}\langle\hat{S}_2^+\rangle&amp;=&amp;-i\Omega_2\langle\hat{S}_2^+\rangle \:\mathrm{ : state\:2} \\
 &amp; &amp; \\
\langle\hat{S}_1^+\rangle(t)&amp;=&amp;\exp(-i\Omega_1 t) \\
\langle\hat{S}_2^+\rangle(t)&amp;=&amp;\exp(-i\Omega_2 t)
\end{eqnarray}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ex0</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">ExpSys</span><span class="p">(</span><span class="n">v0H</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">Nucs</span><span class="o">=</span><span class="s1">&#39;1H&#39;</span><span class="p">)</span>    <span class="c1">#Experimental system at 500 MHz with one 1H</span>
<span class="n">ex0</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CS&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">Hz</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>     <span class="c1">#Add a chemical shift to the system</span>
<span class="n">ex1</span><span class="o">=</span><span class="n">ex0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>                      <span class="c1">#Copy system for second system in exchange </span>
<span class="n">ex1</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CS&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">Hz</span><span class="o">=-</span><span class="mi">500</span><span class="p">)</span>    <span class="c1">#Add a chemical shift to the second system</span>
<span class="n">L</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Liouvillian</span><span class="p">(</span><span class="n">ex0</span><span class="p">,</span><span class="n">ex1</span><span class="p">)</span>               <span class="c1">#Generate a Liouvillian for the system</span>
<span class="n">seq</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">Sequence</span><span class="p">(</span><span class="n">Dt</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>       <span class="c1">#Sequence with a 25 microsecond length</span>

<span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;1Hx&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="s1">&#39;1Hp&#39;</span><span class="p">)</span>
<span class="n">rho</span><span class="o">.</span><span class="n">DetProp</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0f576ef2bc87a5009222efe5e451be1ab32aa28b04993cebde930acc9d9c990e.png" src="../_images/0f576ef2bc87a5009222efe5e451be1ab32aa28b04993cebde930acc9d9c990e.png" />
</div>
</div>
<p>As we see, the system simply oscillates at the given input frequencies. Below, we can check what that frequency actually is, by taking the Fourier transform of the above signal, where we see that indeed it oscillates at +500 and -500 Hz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">FT</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2b29a1870c2fd1f31e792224d4721fe91664f051cc5f4604219d23c587853898.png" src="../_images/2b29a1870c2fd1f31e792224d4721fe91664f051cc5f4604219d23c587853898.png" />
</div>
</div>
<p>However, if we couple the two states together with an exchange matrix, the situation changes dramatically, yielding broadening in the spectrum, and if fast enough, coalescence of the peaks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="mf">5e-4</span><span class="p">)</span>
<span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="n">rho0</span><span class="o">=</span><span class="s1">&#39;1Hx&#39;</span><span class="p">,</span><span class="n">detect</span><span class="o">=</span><span class="s1">&#39;1Hp&#39;</span><span class="p">)</span>
<span class="n">rho</span><span class="o">.</span><span class="n">DetProp</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">FT</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ebe7d43fa42d613f7dfb282bdb21aeb2cf18cbc99af3c9398d2b7a0512ad9a69.png" src="../_images/ebe7d43fa42d613f7dfb282bdb21aeb2cf18cbc99af3c9398d2b7a0512ad9a69.png" />
</div>
</div>
<section id="exercise-1-1">
<h3>Exercise 1.1:<a class="headerlink" href="#exercise-1-1" title="Link to this heading">#</a></h3>
<p>Typing any of the above objects (<code class="docutils literal notranslate"><span class="pre">ex0</span></code>,<code class="docutils literal notranslate"><span class="pre">ex1</span></code>,<code class="docutils literal notranslate"><span class="pre">L</span></code>,<code class="docutils literal notranslate"><span class="pre">seq</span></code>,<code class="docutils literal notranslate"><span class="pre">rho</span></code>) at the command line will produce a description of the object. Objects also have a <code class="docutils literal notranslate"><span class="pre">plot</span></code> function (<code class="docutils literal notranslate"><span class="pre">ex0</span></code>,<code class="docutils literal notranslate"><span class="pre">ex1</span></code> have a <code class="docutils literal notranslate"><span class="pre">plot_inter</span></code> function, although this is not so informative for isotropic interactions). Try this to get a feeling for what the critical settings are in this simulation. What is the role of each object in the simulation?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use this cell to investigate the different objects</span>
</pre></div>
</div>
</div>
</div>
<div class="toggle docutils container">
<ul class="simple">
<li><p>ExpSys (ex0,ex1) : defines spins in the magnetic field, spins in the system, and interactions</p></li>
<li><p>Liouvillian (L) : Contains each of the ExpSys objects and the Liouvillian matrix, as well as an exchange matrix (currently set to zeros).</p></li>
<li><p>Sequence (seq) : Contains definitions of the field strengths, and defines length of propagation steps.</p></li>
<li><p>Rho (rho) : Contains the initial state of the system and the detection matrix, as well as the signal.</p></li>
</ul>
</div>
<p>Now, assume that the system is in one of two states, with chemical shift frequencies <span class="math notranslate nohighlight">\(\Omega_1\)</span> and <span class="math notranslate nohighlight">\(\Omega_2\)</span>. This leads to a coupled set of equations, given by:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
\frac{d}{dt}\langle\hat{S}_1^+\rangle&amp;=&amp;-i\Omega_1\langle\hat{S}_1^+\rangle+k_{21}\langle\hat{S}_2^+\rangle-k_{12}\langle\hat{S}_1^+\rangle \\
\frac{d}{dt}\langle\hat{S}_2^+\rangle&amp;=&amp;-i\Omega_2\langle\hat{S}_2^+\rangle-k_{21}\langle\hat{S}_2^+\rangle+k_{12}\langle\hat{S}_1^+\rangle
\end{eqnarray}
\end{split}\]</div>
<p>These equations express both the transfer between state 1 and state 2, and the evolution due to the oscillation frequencies.</p>
<p>We may express the exchange process as a matrix.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\mathbf{k}=
\begin{pmatrix}
-k_{12} &amp; k_{21} \\ k_{12} &amp;- k_{21}
\end{pmatrix}
\end{split}\]</div>
<p>Note that for this to be a valid exchange matrix, the columns must sum to one, and it must satisfy detailed balance, that is for populations <span class="math notranslate nohighlight">\(p_m\)</span> and <span class="math notranslate nohighlight">\(p_n\)</span>, we require that <span class="math notranslate nohighlight">\(p_m/p_n=k_{n,m}/k_{m,n}\)</span>.</p>
<p>The system of equations can be expressed with a matrix including the oscillation, which yields the following differential equation:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\frac{d}{dt}
\begin{pmatrix}
\langle\hat{S}^+_1\rangle \\ \langle\hat{S}^+_2\rangle
\end{pmatrix}
=
\begin{pmatrix}
-i\Omega_1 - k_{12} &amp; k_{21} \\ k_{12} &amp; -i\Omega_2 - k_{21}
\end{pmatrix}
\cdot
\begin{pmatrix}
\langle\hat{S}^+_1\rangle \\ \langle\hat{S}^+_2\rangle
\end{pmatrix}
\end{split}\]</div>
<p>This matrix indicates that if we are in state 1, the phase of <span class="math notranslate nohighlight">\(\hat{S}_1^+\)</span> will oscillate with frequency of <span class="math notranslate nohighlight">\(\Omega_1\)</span>, but it will also diffuse with rate <span class="math notranslate nohighlight">\(k_{12}\)</span> to state 2, where it will oscillate with frequency <span class="math notranslate nohighlight">\(\Omega_2\)</span> and also potentially diffuse back to state one (with rate <span class="math notranslate nohighlight">\(k_{21}\)</span>).</p>
<section id="some-hints-on-2x2-exchange-matrices">
<h4>Some hints on 2x2 exchange matrices<a class="headerlink" href="#some-hints-on-2x2-exchange-matrices" title="Link to this heading">#</a></h4>
<p>A 2x2 exchange matrix has two eigenvalues. One must always be zero, corresponding to the equilibrium of the exchange. Any evolution of the matrix occurs with a rate constant given by the other eigenvalue. This eigenvalue is equal to <span class="math notranslate nohighlight">\(-(k_{12}+k_{21})\)</span>. We therefore often define <span class="math notranslate nohighlight">\(k=(k_{12}+k_{21})/2\)</span>, and <span class="math notranslate nohighlight">\(\tau_c=1/(2k)\)</span>.</p>
</section>
</section>
<section id="exercise-1-2">
<h3>Exercise 1.2:<a class="headerlink" href="#exercise-1-2" title="Link to this heading">#</a></h3>
<p>To understand exchange analytically, we often make some simplifying assumptions about the terms. First, we set <span class="math notranslate nohighlight">\(\Omega_1=\Delta\Omega/2\)</span> and <span class="math notranslate nohighlight">\(\Omega_2=-\Delta\Omega/2\)</span>. We also assume symmetric exchange, such that <span class="math notranslate nohighlight">\(k_{12}=k_{21}=k\)</span>. This yields the following exchange matrix:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\mathbf{k}=
\begin{pmatrix}
-i\Delta\Omega/2 - k &amp; k \\ k &amp; i\Delta\Omega/2 - k
\end{pmatrix}
\end{split}\]</div>
<p>Find the eigenvalues of this matrix, where each eigenvalue represents the evolution of a signal in the NMR spectrum. We won’t solve for the eigenvectors here, but these also play a role in the contributions of each signal.</p>
<p>Under what conditions do we observe two separated chemical shifts? What is <span class="math notranslate nohighlight">\(T_2\)</span> in this case? What is <span class="math notranslate nohighlight">\(T_2\)</span> if there is only one chemical shift?</p>
<p>Hint: <span class="math notranslate nohighlight">\(T_2\)</span> is the negative inverse of the real part of the eigenvalues, whereas the imaginary part yields oscillation frequencies</p>
<p>The answer is given in multiple steps, so if you’re not sure how to start, go ahead and open the first answer.</p>
<section id="part-1">
<h4>Part 1<a class="headerlink" href="#part-1" title="Link to this heading">#</a></h4>
<div class="toggle docutils container">
<p>Eigenvalues are found by calculating the determinant of the matrix minus <span class="math notranslate nohighlight">\(\lambda\cdot\mathbb{1}\)</span>, setting it to zero, and solving for the values of <span class="math notranslate nohighlight">\(\lambda\)</span> (<span class="math notranslate nohighlight">\(\mathbb{1}\)</span> is an identity matrix)</p>
<div class="math notranslate nohighlight">
\[\begin{split}
0=\det
\begin{pmatrix}
-i\Delta\Omega/2-k-\lambda &amp; k \\ k &amp; i\Delta\Omega/2-k-\lambda
\end{pmatrix}
\end{split}\]</div>
</div>
</section>
<section id="part-2">
<h4>Part 2<a class="headerlink" href="#part-2" title="Link to this heading">#</a></h4>
<div class="toggle docutils container">
<p>The determinant for a 2x2 matrix is calculated by taking the (0,0) element times the (1,1) element minus the (0,1) element times the (1,0) element.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
0&amp;=&amp;(-i\Delta\Omega/2-k-\lambda)\cdot(i\Delta\Omega/2-k-\lambda)-k^2 \\
0&amp;=&amp;\lambda^2+2k\lambda+\frac{(\Delta\Omega)^2}{4}
\end{eqnarray}
\end{split}\]</div>
</div>
</section>
<section id="part-3">
<h4>Part 3<a class="headerlink" href="#part-3" title="Link to this heading">#</a></h4>
<div class="toggle docutils container">
<p>We can solve for the eigenvalues using the quadratic formula.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
0&amp;=&amp;ax^2+bx+c \\
x&amp;=&amp;\frac{-b\pm\sqrt{b^2-4ac}}{2a}
\end{eqnarray}
\end{split}\]</div>
<p>Then,</p>
<div class="math notranslate nohighlight">
\[
\lambda=\frac{-2k\pm\sqrt{4k^2-(\Delta\Omega)^2}}{2}
\]</div>
</div>
</section>
<section id="part-4">
<h4>Part 4<a class="headerlink" href="#part-4" title="Link to this heading">#</a></h4>
<div class="toggle docutils container">
<p>The real part of the eigenvalues is the negative inverse of <span class="math notranslate nohighlight">\(T_2\)</span>, whereas the imaginary part is the frequency. When <span class="math notranslate nohighlight">\(2k&gt;\Delta\Omega\)</span>, then the eigenvalues are strictly real. This means that there is only a single frequency (at 0) in the spectrum, but a complex lineshape with two decay rates. On the other hand, if <span class="math notranslate nohighlight">\(2k&lt;\Delta\Omega\)</span>, then two distinct frequencies emerge. The real part is then only <span class="math notranslate nohighlight">\(-k\)</span>, so <span class="math notranslate nohighlight">\(T_2=1/k\)</span>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{matrix}
2k&gt;&gt;\Delta\Omega &amp; T_2=\infty,1/(2k) &amp; \Omega=0 \\
2k&gt;\Delta\Omega &amp; T_2=1/(k\mp\sqrt{k^2-(\Delta\Omega/2)^2}) &amp; \Omega=0 \\
2k=\Delta\Omega &amp; T_2=1/k &amp; \Omega=0 \\
2k&lt;\Delta\Omega &amp; T_2=1/k &amp; \Omega=\pm\sqrt{(\Delta\Omega/2)^2-k^2} \\
2k&lt;&lt;\Delta\Omega &amp; T_2=1/k &amp; \Omega=\pm\Delta\Omega/2
\end{matrix}
\end{split}\]</div>
<p>Note that when <span class="math notranslate nohighlight">\(k&gt;\Delta\Omega\)</span>, there are two peaks with the same apparent chemical shift. As <span class="math notranslate nohighlight">\(k\)</span> gets large, the contribution of <span class="math notranslate nohighlight">\(T_2=1/(2k)\)</span> becomes smaller, such that the peak becomes increasingly narrow, rather than wide.</p>
</div>
</section>
</section>
<section id="exercise-1-3">
<h3>Exercise 1.3<a class="headerlink" href="#exercise-1-3" title="Link to this heading">#</a></h3>
<p>Above, we set up a simulation with two different chemical shifts in exchange (<span class="math notranslate nohighlight">\(\pm\)</span>500 Hz, so <span class="math notranslate nohighlight">\(\Delta\Omega=2*\pi*1000\)</span> rad/s). Adjust <span class="math notranslate nohighlight">\(k\)</span> to the different conditions in the solution above to observe the effect.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span><span class="o">=</span><span class="mi">0</span>
<span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="p">[[</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">],[</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">k</span><span class="p">]]</span>

<span class="n">_</span><span class="o">=</span><span class="n">OneD</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3983ad87e3774d9d1311f22dec3fbe72fba8eebda8c427e0dc9d3fb5cd81573e.png" src="../_images/3983ad87e3774d9d1311f22dec3fbe72fba8eebda8c427e0dc9d3fb5cd81573e.png" />
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">ax</span><span class="o">=</span><span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="n">DeltaCS</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">expsys</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Hz&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">L</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">expsys</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Hz&#39;</span><span class="p">]</span>  <span class="c1">#Change in chemical shift (Hz)</span>
<span class="n">sqrt0</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">DeltaCS</span><span class="o">/</span><span class="mi">2</span>   <span class="c1">#This is where the square root is zero</span>
<span class="n">k0</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="o">*</span><span class="n">sqrt0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">sqrt0</span><span class="p">,</span><span class="n">sqrt0</span><span class="p">,</span><span class="n">sqrt0</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">sqrt0</span><span class="o">/</span><span class="mi">50</span><span class="p">]</span>
<span class="n">titles</span><span class="o">=</span><span class="p">[</span><span class="sa">rf</span><span class="s1">&#39;$2k</span><span class="si">{</span><span class="n">sign</span><span class="si">}</span><span class="s1">\Delta\Omega$&#39;</span> <span class="k">for</span> <span class="n">sign</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;\gg&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;\ll&#39;</span><span class="p">]]</span>

<span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">title</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">k0</span><span class="p">,</span><span class="n">titles</span><span class="p">):</span>
    <span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="p">[[</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">],[</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">k</span><span class="p">]]</span>
    <span class="n">OneD</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c1240360cdbb906cb7e605dc7516d59116fda83fedbae7673c9212044ee91d11.png" src="../_images/c1240360cdbb906cb7e605dc7516d59116fda83fedbae7673c9212044ee91d11.png" />
</div>
</details>
</div>
<p>The full Liouville matrix for the above system is an 8x8 matrix, but most terms do not actually enter into the calculation, reducing to the 2x2 matrix already discussed. SLEEPY will automatically pick out the required terms. We may then adjust the exchange matrix and extract the eigenvalues of the Liouville matrix for the conditions above, in order to find <span class="math notranslate nohighlight">\(T_2\)</span> and the resonance frequencies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="s1">&#39;S0x&#39;</span><span class="p">,</span><span class="s1">&#39;S0p&#39;</span><span class="p">)</span>
<span class="n">rho_r</span><span class="p">,</span><span class="n">_</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">ReducedSetup</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">U</span><span class="p">(</span><span class="mf">.1</span><span class="p">))</span>  
<span class="n">L_r</span><span class="o">=</span><span class="n">rho_r</span><span class="o">.</span><span class="n">L</span>   <span class="c1"># The reduced Liouvillian is not returned directly</span>
<span class="n">DeltaCS</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">expsys</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Hz&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">L</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">expsys</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Hz&#39;</span><span class="p">]</span>  <span class="c1">#Change in chemical shift (Hz)</span>
<span class="n">sqrt0</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">DeltaCS</span><span class="o">/</span><span class="mi">2</span>   <span class="c1">#This is where the square root is zero</span>
<span class="n">k0</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="o">*</span><span class="n">sqrt0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">sqrt0</span><span class="p">,</span><span class="n">sqrt0</span><span class="p">,</span><span class="n">sqrt0</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">sqrt0</span><span class="o">/</span><span class="mi">50</span><span class="p">]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">k0</span><span class="p">:</span>
    <span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="p">[[</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">],[</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="n">k</span><span class="p">]]</span>
    <span class="n">Lambda</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">L_r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="p">(</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;k=</span><span class="si">{</span><span class="n">k</span><span class="si">:</span><span class="s1">.1</span><span class="si">}</span><span class="s1"> s^-1, &#39;</span><span class="o">+</span>\
          <span class="sa">f</span><span class="s1">&#39;T2=</span><span class="si">{</span><span class="o">-</span><span class="mf">1e3</span><span class="o">/</span><span class="n">Lambda</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="si">:</span><span class="s1">5.2f</span><span class="si">}</span><span class="s1"> ms, T2=</span><span class="si">{</span><span class="o">-</span><span class="mf">1e3</span><span class="o">/</span><span class="n">Lambda</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="si">:</span><span class="s1">5.2f</span><span class="si">}</span><span class="s1"> ms,&#39;</span><span class="o">+</span>\
          <span class="sa">f</span><span class="s1">&#39;f=</span><span class="si">{</span><span class="o">-</span><span class="n">Lambda</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="si">:</span><span class="s1">6.1f</span><span class="si">}</span><span class="s1"> Hz, f=</span><span class="si">{</span><span class="o">-</span><span class="n">Lambda</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="si">:</span><span class="s1">6.1f</span><span class="si">}</span><span class="s1"> Hz&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k=2e+05 s^-1, T2=31.83 ms, T2= 0.00 ms,f=  -0.0 Hz, f=  -0.0 Hz
k=6e+03 s^-1, T2= 1.19 ms, T2= 0.09 ms,f=  -0.0 Hz, f=   0.0 Hz
k=3e+03 s^-1, T2= 0.32 ms, T2= 0.32 ms,f=  -0.0 Hz, f=   0.0 Hz
k=2e+03 s^-1, T2= 0.64 ms, T2= 0.64 ms,f=-433.0 Hz, f= 433.0 Hz
k=6e+01 s^-1, T2=15.92 ms, T2=15.92 ms,f=-499.9 Hz, f= 499.9 Hz
</pre></div>
</div>
</div>
</div>
<p>Note that we have assumed symmetric exchange. However, similar effects occur for asymmetric exchange. These are simulated below for the same conditions. The <code class="docutils literal notranslate"><span class="pre">twoSite_kex</span></code> tool builds an exchange matrix for us, defined by a correlation time <span class="math notranslate nohighlight">\(1/(2k)\)</span> and a population for the first state.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>
<span class="n">ax</span><span class="o">=</span><span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="n">DeltaCS</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">expsys</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Hz&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">L</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">expsys</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Hz&#39;</span><span class="p">]</span>  <span class="c1">#Change in chemical shift (Hz)</span>
<span class="n">sqrt0</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">DeltaCS</span><span class="o">/</span><span class="mi">2</span>   <span class="c1">#This is where the square root is zero</span>
<span class="n">k0</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="o">*</span><span class="n">sqrt0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">sqrt0</span><span class="p">,</span><span class="n">sqrt0</span><span class="p">,</span><span class="n">sqrt0</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">sqrt0</span><span class="o">/</span><span class="mi">50</span><span class="p">]</span>
<span class="n">titles</span><span class="o">=</span><span class="p">[</span><span class="sa">rf</span><span class="s1">&#39;$2k</span><span class="si">{</span><span class="n">sign</span><span class="si">}</span><span class="s1">\Delta\Omega$&#39;</span> <span class="k">for</span> <span class="n">sign</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;\gg&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;\ll&#39;</span><span class="p">]]</span>

<span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">title</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">k0</span><span class="p">,</span><span class="n">titles</span><span class="p">):</span>
    <span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">),</span><span class="n">p1</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
    <span class="n">OneD</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7defa4168fc2950e501051f372687e317a87dbfdb7879b283c9e3da7c623e340.png" src="../_images/7defa4168fc2950e501051f372687e317a87dbfdb7879b283c9e3da7c623e340.png" />
</div>
</div>
<p>We repeat the eigenvalue calculation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rho</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Rho</span><span class="p">(</span><span class="s1">&#39;S0x&#39;</span><span class="p">,</span><span class="s1">&#39;S0p&#39;</span><span class="p">)</span>
<span class="n">rho_r</span><span class="p">,</span><span class="n">_</span><span class="o">=</span><span class="n">rho</span><span class="o">.</span><span class="n">ReducedSetup</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">U</span><span class="p">(</span><span class="mf">.1</span><span class="p">))</span>
<span class="n">L_r</span><span class="o">=</span><span class="n">rho_r</span><span class="o">.</span><span class="n">L</span>   <span class="c1"># The reduced Liouvillian is not returned directly</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">k0</span><span class="p">:</span>
    <span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">),</span><span class="n">p1</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
    <span class="n">Lambda</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">L_r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="p">(</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;k=</span><span class="si">{</span><span class="n">k</span><span class="si">:</span><span class="s1">.1</span><span class="si">}</span><span class="s1"> s^-1,&#39;</span><span class="o">+</span>\
          <span class="sa">f</span><span class="s1">&#39;T2=</span><span class="si">{</span><span class="o">-</span><span class="mf">1e3</span><span class="o">/</span><span class="n">Lambda</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="si">:</span><span class="s1">5.2f</span><span class="si">}</span><span class="s1"> ms, T2=</span><span class="si">{</span><span class="o">-</span><span class="mf">1e3</span><span class="o">/</span><span class="n">Lambda</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="si">:</span><span class="s1">5.2f</span><span class="si">}</span><span class="s1"> ms,&#39;</span><span class="o">+</span>\
          <span class="sa">f</span><span class="s1">&#39;f=</span><span class="si">{</span><span class="o">-</span><span class="n">Lambda</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="si">:</span><span class="s1">5.1f</span><span class="si">}</span><span class="s1"> Hz, f=</span><span class="si">{</span><span class="o">-</span><span class="n">Lambda</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="si">:</span><span class="s1">5.1f</span><span class="si">}</span><span class="s1"> Hz&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>k=2e+05 s^-1,T2= 0.00 ms, T2=37.89 ms,f=-200.0 Hz, f=200.0 Hz
k=6e+03 s^-1,T2= 0.08 ms, T2= 1.51 ms,f=-223.6 Hz, f=223.6 Hz
k=3e+03 s^-1,T2= 0.19 ms, T2= 0.87 ms,f=-316.2 Hz, f=316.2 Hz
k=2e+03 s^-1,T2= 0.44 ms, T2= 1.15 ms,f=-447.2 Hz, f=447.2 Hz
k=6e+01 s^-1,T2=11.37 ms, T2=26.53 ms,f=-499.9 Hz, f=499.9 Hz
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-1-4">
<h3>Exercise 1.4<a class="headerlink" href="#exercise-1-4" title="Link to this heading">#</a></h3>
<p>What do you see that’s different about the results of the eigenvalue calculation above vs. symmetric exchange.</p>
<div class="toggle docutils container">
<p>There are always two unique frequencies for asymmetric exchange. In symmetric exchange, when <span class="math notranslate nohighlight">\(2k&gt;\Delta\Omega\)</span>, a coalescence condition occured and the two peaks collapse into a single frequency. In asymmetric exchange, no coalescence condition exists. One peak just becomes increasingly weak until it is effectively invisible.</p>
</div>
<p>In chemical exchange in 1D, in principle, we can extract populations of the two states and rates of exchange between them, simply by fitting the spectrum. However, other sources of relaxation (e.g. tumbling in solution) will contribute to the broadening, complicating the extraction of exchange rates and populations from the spectra alone. In this case, we usually need a reference sample which should have the same <span class="math notranslate nohighlight">\(T_2\)</span> without exchange present. This is not always available, so one may need to consider other approaches.</p>
<p>A second challenge is what to do when there is not significant broadening in the 1D experiment; indeed, unless <span class="math notranslate nohighlight">\(2k\approx\Delta\Omega\)</span>, this is the case.</p>
</section>
</section>
<section id="chemical-exchange-in-2d">
<h2>Chemical Exchange in 2D<a class="headerlink" href="#chemical-exchange-in-2d" title="Link to this heading">#</a></h2>
<p>In the 1D spectra above, we get significant broadening for the case that rate of exchange (<span class="math notranslate nohighlight">\(2k\)</span>) is on the order of the size in chemical shift. However, what should we do if this is not the case? The first possibility is that motion is much slower than the chemical shift size. Then, we obtain narrow lines, where broadening is likely dominated by other sources of relaxation so that we cannot easily extract exchange rates.</p>
<p>In this case, we may use Exchange Spectroscopy (EXSY). This is a 2D experiment, where we evolve in the indirect dimension, flip the magnetization to the <em>z</em>-axis, wait to allow exchange to occur, and then flip magnetization back to the <em>x</em>-axis to observe the emergence of new frequencies.</p>
<p>We include some <span class="math notranslate nohighlight">\(T_2\)</span> relaxation to broaden the spectra slightly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="mf">.2</span><span class="p">,</span><span class="n">p1</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">L</span><span class="o">.</span><span class="n">add_relax</span><span class="p">(</span><span class="s1">&#39;T2&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">T2</span><span class="o">=</span><span class="mf">.05</span><span class="p">)</span>

<span class="n">_</span><span class="o">=</span><span class="n">EXSY</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">buildup</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#dly is the length of time between flip up and flip down</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4086993743c97f05b78417567feb800d60cfcc69596b36367daa329c788ee2b0.png" src="../_images/4086993743c97f05b78417567feb800d60cfcc69596b36367daa329c788ee2b0.png" />
</div>
</div>
<section id="exercise-2-1">
<h3>Exercise 2.1<a class="headerlink" href="#exercise-2-1" title="Link to this heading">#</a></h3>
<p>Write formulas for the peak integrals for a delay much longer than the length of the correlation time of exchange. That is, what is <span class="math notranslate nohighlight">\(I_{1,1}\)</span>, <span class="math notranslate nohighlight">\(I_{1,2}\)</span>, <span class="math notranslate nohighlight">\(I_{2,1}\)</span>, <span class="math notranslate nohighlight">\(I_{2,2}\)</span> as a function of <span class="math notranslate nohighlight">\(p_1\)</span> and <span class="math notranslate nohighlight">\(p_2\)</span>, where <span class="math notranslate nohighlight">\(I_{1,2}\)</span> is the peak corresponding to magnetization starting in state one and ending in state 2, for example, and <span class="math notranslate nohighlight">\(p_1\)</span> and <span class="math notranslate nohighlight">\(p_2\)</span></p>
<p>We can take the populations as probabilities, and so the probability of starting in state 1 and ending in state one is simply <span class="math notranslate nohighlight">\(p_1*p_1\)</span> (<span class="math notranslate nohighlight">\(=I_{1,1})\)</span>. Find the others by analogy.</p>
<div class="toggle docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
I_{1,1}&amp;=&amp;p_1^2 \\ 
I_{1,2}&amp;=&amp;p_1p_2 \\
I_{2,1}&amp;=&amp;p_1p_2 \\
I_{2,2}&amp;=&amp;p_2^2
\end{eqnarray}
\end{split}\]</div>
</div>
</section>
<section id="exercise-2-2">
<h3>Exercise 2.2<a class="headerlink" href="#exercise-2-2" title="Link to this heading">#</a></h3>
<p>For a given delay, <span class="math notranslate nohighlight">\(\tau\)</span>, and exchange rate constants <span class="math notranslate nohighlight">\(k_{12}\)</span> and <span class="math notranslate nohighlight">\(k_{21}\)</span>, give the peak intensities.</p>
<p>Hint: Give your answer in terms of <span class="math notranslate nohighlight">\(p_1\)</span>, <span class="math notranslate nohighlight">\(p_2\)</span>, and <span class="math notranslate nohighlight">\(2k\)</span> (<span class="math notranslate nohighlight">\(2k=k_1+k_2\)</span>).</p>
<div class="toggle docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
I_{1,1}(\tau)&amp;=&amp;p_1^2+(p_1-p_1^2)\exp(-2k\tau) \\
I_{1,2}(\tau)&amp;=&amp;p_1p_2(1-\exp(-2k\tau)) \\
I_{2,1}(\tau)&amp;=&amp;p_1p_2(1-\exp(-2k\tau)) \\
I_{2,2}(\tau)&amp;=&amp;p_2^2+(p_2-p_2^2)\exp(-2k\tau)
\end{eqnarray}
\end{split}\]</div>
</div>
<p>Below, we plot the buildup of peak intensities for our system, where we observe the expected behavior. Dotted lines show the result from the formulas above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dly</span><span class="o">=</span><span class="mi">1</span>
<span class="n">ax</span><span class="o">=</span><span class="n">EXSY</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="n">dly</span><span class="p">)</span>
<span class="n">t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dly</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">k</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">p1</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">p2</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">p1</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span><span class="n">p1</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">p1</span><span class="o">-</span><span class="n">p1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">k</span><span class="p">),</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span><span class="n">p2</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">p2</span><span class="o">-</span><span class="n">p2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">k</span><span class="p">),</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span><span class="n">p1</span><span class="o">*</span><span class="n">p2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="o">*</span><span class="n">k</span><span class="p">)),</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f7cf15e6160&gt;]
</pre></div>
</div>
<img alt="../_images/aab8383dafb10154949547f96a4c37687252046700e6ef7e015c12963cff66a9.png" src="../_images/aab8383dafb10154949547f96a4c37687252046700e6ef7e015c12963cff66a9.png" />
</div>
</div>
</section>
<section id="exercise-2-3">
<h3>Exercise 2.3<a class="headerlink" href="#exercise-2-3" title="Link to this heading">#</a></h3>
<p>When, roughly, is exchange too fast (or two slow) for the EXSY experiment? What are the problems that arise? Edit <code class="docutils literal notranslate"><span class="pre">k</span></code> in the cell below. When <code class="docutils literal notranslate"><span class="pre">k</span></code> is large, you may want to shorten the total delay in the second call to EXSY. Note that we have added <span class="math notranslate nohighlight">\(T_1\)</span> relaxation to the Liouvillian (why is this relevant? Can you edit the buildup formulas accordingly?)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span><span class="o">=</span><span class="mi">1</span>
<span class="n">L</span><span class="o">.</span><span class="n">clear_relax</span><span class="p">()</span>
<span class="n">L</span><span class="o">.</span><span class="n">add_relax</span><span class="p">(</span><span class="s1">&#39;T2&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">T2</span><span class="o">=</span><span class="mf">.05</span><span class="p">)</span>
<span class="n">L</span><span class="o">.</span><span class="n">add_relax</span><span class="p">(</span><span class="s1">&#39;T1&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">T1</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">),</span><span class="n">p1</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">ax</span><span class="o">=</span><span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">),</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>
<span class="n">EXSY</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">buildup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span><span class="o">=</span><span class="n">EXSY</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">buildup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1b53814c3ae8620f81ac9e35dd3f4116a2b284bf5c3c58bb7a892313a745bb55.png" src="../_images/1b53814c3ae8620f81ac9e35dd3f4116a2b284bf5c3c58bb7a892313a745bb55.png" />
</div>
</div>
<div class="toggle docutils container">
<p>Around <span class="math notranslate nohighlight">\(k&gt;1500\)</span>, the 2D spectrum becomes too broad to separate the individual peaks and so we can no longer easily extract exchange rates from the EXSY buildup curves. On the other hand, if <span class="math notranslate nohighlight">\(k&lt;0.15\)</span>, the peaks decay faster than any significant transfer occurs. Then, the formulas for the peak intensities are</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{eqnarray}
I_{1,1}(\tau)&amp;=&amp;(p_1^2+(p_1-p_1^2)\exp(-k\tau))\cdot\exp(-\tau/T_1) \\
I_{1,2}(\tau)&amp;=&amp;p_1p_2(1-\exp(-k\tau))\cdot\exp(-\tau/T_1) \\
I_{2,1}(\tau)&amp;=&amp;p_1p_2(1-\exp(-k\tau))\cdot\exp(-\tau/T_1) \\
I_{2,2}(\tau)&amp;=(&amp;p_2^2+(p_2-p_2^2)\exp(-k\tau))\cdot\exp(-\tau/T_1)
\end{eqnarray}
\end{split}\]</div>
<p>Then, the relevant parameters are <span class="math notranslate nohighlight">\(\Delta\Omega\)</span>, where if <span class="math notranslate nohighlight">\(k&gt;&gt;\Delta\Omega\)</span>, peaks become too broad, and if <span class="math notranslate nohighlight">\(k&lt;&lt;1/T_1\)</span>, then signal intensity is lost too quickly to use EXSY</p>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="n">ax</span><span class="o">=</span><span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">),</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
   <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">),</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)]</span>

<span class="n">k</span><span class="o">=</span><span class="mi">1500</span>
<span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">),</span><span class="n">p1</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">EXSY</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">buildup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span><span class="o">=</span><span class="n">EXSY</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mf">.005</span><span class="p">,</span><span class="n">buildup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">k</span><span class="o">=</span><span class="mf">0.15</span>
<span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">),</span><span class="n">p1</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">EXSY</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">buildup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">_</span><span class="o">=</span><span class="n">EXSY</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">buildup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/85f0df8e22008ac85b3112734f6897d024414cbf820d7d5da99e275fb1dae7d5.png" src="../_images/85f0df8e22008ac85b3112734f6897d024414cbf820d7d5da99e275fb1dae7d5.png" />
</div>
</details>
</div>
</section>
</section>
<section id="r-1-rho-and-cpmg">
<h2><span class="math notranslate nohighlight">\(R_{1\rho}\)</span> and CPMG<a class="headerlink" href="#r-1-rho-and-cpmg" title="Link to this heading">#</a></h2>
<p>Thus far, our rate of exchange has been near the difference in chemical shift (<span class="math notranslate nohighlight">\(\Delta\Omega\)</span>), or slower. The next question is, what can we do when it is faster? In this case, we have the options of measuring <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> or CPMG (Carr-Purcell-Meiboom-Gill). The former experiment simply applies a spin-locking field to magnetization with a given frequency, whereas the latter uses a train of pulses to periodically refocus the magnetization. Applied on-resonance, the performance of the two experiments is fairly similar.</p>
<p>Below, we first calculate the lineshape for <span class="math notranslate nohighlight">\(k=1\cdot10^5\)</span> s, where we note that the resulting line is fairly narrow and from which it would be difficult to extract dynamics information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span><span class="o">=</span><span class="mf">1e5</span>
<span class="n">L</span><span class="o">.</span><span class="n">clear_relax</span><span class="p">()</span>
<span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">))</span>
<span class="n">_</span><span class="o">=</span><span class="n">OneD</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/53ebe6c47fa625e80f09b3bf73bc39b9b329a06c119ae1152d67521386ca7e27.png" src="../_images/53ebe6c47fa625e80f09b3bf73bc39b9b329a06c119ae1152d67521386ca7e27.png" />
</div>
</div>
<p>Then, we would like to obtain more information. For this we can apply the <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> or CPMG experiments. These are shown below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">R1p</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$R_{1\rho}$&#39;</span><span class="p">)</span>
<span class="n">CPMG</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;CPMG&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1e86c4372950efb8c8884b87f404fa9328540254948a5d6a1d0597ad17343a86.png" src="../_images/1e86c4372950efb8c8884b87f404fa9328540254948a5d6a1d0597ad17343a86.png" />
</div>
</div>
<p>Note that the two sets of experiments yield fairly similar results; for this case, the information content is about the same. However, <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> may be applied off-resonance, yielding some additional information about the relaxation (not investigated here).</p>
<section id="exercise-3-1">
<h3>Exercise 3.1<a class="headerlink" href="#exercise-3-1" title="Link to this heading">#</a></h3>
<p>The dispersion as a function of spin-lock strength or pulse-frequency can be fit to obtain the amplitude and correlation time of exchange. At what rate does the dispersion vanish for each experiment? Adjust <code class="docutils literal notranslate"><span class="pre">k</span></code> below.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span><span class="o">=</span><span class="mf">1e3</span>
<span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">R1p</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$R_{1\rho}$&#39;</span><span class="p">)</span>
<span class="n">CPMG</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;CPMG&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<img alt="../_images/eb2f1b0abadb5190600c918566dc0b352492589761d0f5a93833b743235d0626.png" src="../_images/eb2f1b0abadb5190600c918566dc0b352492589761d0f5a93833b743235d0626.png" />
</div>
</details>
</div>
<div class="toggle docutils container">
<p>Differences between <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> curves are effectively gone for <span class="math notranslate nohighlight">\(k&gt;10^6\)</span> s<span class="math notranslate nohighlight">\(^{-1}\)</span>. For CPMG, there are some differences in the curves, but these never completely vanish, and cannot be used for extracting the rate of exchange.</p>
</div>
</section>
<section id="exercise-3-2">
<h3>Exercise 3.2<a class="headerlink" href="#exercise-3-2" title="Link to this heading">#</a></h3>
<p>Below, we plot <span class="math notranslate nohighlight">\(R_{1\rho}\)</span> curves for <span class="math notranslate nohighlight">\(k=1\cdot10^4\)</span> s<span class="math notranslate nohighlight">\(^{-1}\)</span>, first with <span class="math notranslate nohighlight">\(\Delta\Omega/(2\pi)\)</span>=1000 Hz, and <span class="math notranslate nohighlight">\(p_1=p_2=0.5\)</span>. In the second calculation, we adjust <span class="math notranslate nohighlight">\(p_1=0.9\)</span> and <span class="math notranslate nohighlight">\(p_2=0.1\)</span>, but increase <span class="math notranslate nohighlight">\(\Delta\Omega/(2\pi)\)</span>=1667 Hz. What do you notice about the two sets of curves?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span><span class="o">=</span><span class="mf">1e4</span>
<span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">))</span>

<span class="n">p1</span><span class="o">=</span><span class="mf">0.9</span>
<span class="n">DelCS0</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">expsys</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Hz&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">L</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">expsys</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Hz&#39;</span><span class="p">]</span>
<span class="n">DelCS</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">.25</span><span class="o">*</span><span class="n">DelCS0</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">p1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p1</span><span class="p">)))</span>

<span class="n">ex0</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">ExpSys</span><span class="p">(</span><span class="n">v0H</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">Nucs</span><span class="o">=</span><span class="s1">&#39;1H&#39;</span><span class="p">)</span>    <span class="c1">#Experimental system at 500 MHz with one 1H</span>
<span class="n">ex0</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CS&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">Hz</span><span class="o">=</span><span class="n">DelCS</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p1</span><span class="p">))</span>     <span class="c1">#Add a chemical shift to the system</span>
<span class="n">ex1</span><span class="o">=</span><span class="n">ex0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>                      <span class="c1">#Copy system for second system in exchange </span>
<span class="n">ex1</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CS&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">Hz</span><span class="o">=-</span><span class="n">DelCS</span><span class="o">*</span><span class="n">p1</span><span class="p">)</span>    <span class="c1">#Add a chemical shift to the second system</span>
<span class="n">L1</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Liouvillian</span><span class="p">(</span><span class="n">ex0</span><span class="p">,</span><span class="n">ex1</span><span class="p">)</span>               <span class="c1">#Generate a Liouvillian for the system</span>
<span class="n">L1</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">),</span><span class="n">p1</span><span class="o">=</span><span class="n">p1</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">R1p</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">R1p</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/518ceb73440e459dc8b1b41acdf099ecdd81a4cee66fc90137b2c797d2b367b7.png" src="../_images/518ceb73440e459dc8b1b41acdf099ecdd81a4cee66fc90137b2c797d2b367b7.png" />
</div>
</div>
<div class="toggle docutils container">
<p>Despite having different input parameters, the two sets of relaxation curves are all nearly the same. This is because for faster exchange, the term <span class="math notranslate nohighlight">\(p_1p_2\Delta\Omega^2\)</span> scales the relaxation. Then, it is not possible to separate the populations from the change in chemical shift.</p>
</div>
<p>Adjust <code class="docutils literal notranslate"><span class="pre">k</span></code> below. Can you introduce differences in the curves? Under what conditions? See our more extensive tutorial <a class="reference external" href="http://sleepy-nmr.org/html/Chapter2/Ch2_BMRD.html">here</a> for further explanation, and the following reference:</p>
<p>V.Z. Miloushev, A.G. Palmer. <a class="reference external" href="https://doi.org/10.1016/j.jmr.2005.07.023"><em>J. Magn. Reson.</em></a>, <strong>2015</strong>, 177, 221-227</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span><span class="o">=</span><span class="mf">1e4</span>
<span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">))</span>
<span class="n">L1</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">),</span><span class="n">p1</span><span class="o">=</span><span class="n">p1</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">R1p</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mf">.25</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">R1p</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mf">.25</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span><span class="o">=</span><span class="mf">1e2</span>
<span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">))</span>
<span class="n">L1</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">),</span><span class="n">p1</span><span class="o">=</span><span class="n">p1</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">R1p</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mf">.25</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">R1p</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mf">.25</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/70bacf88b5fd19da57db4237e7027d07d82488e1b36cb1f25468479a8071219f.png" src="../_images/70bacf88b5fd19da57db4237e7027d07d82488e1b36cb1f25468479a8071219f.png" />
</div>
</details>
</div>
<div class="toggle docutils container">
<p>Diffences in the curves emerge for <span class="math notranslate nohighlight">\(k&lt;1\cdot10^3\)</span> s<span class="math notranslate nohighlight">\(^{-1}\)</span>, with these becoming more clear around <span class="math notranslate nohighlight">\(k=1\cdot10^2\)</span> s<span class="math notranslate nohighlight">\(^{-1}\)</span>. For slower exchange and low powers, it becomes again possible to separate populations from the change in chemical shift (see the reference above for more details).</p>
</div>
</section>
</section>
<section id="cest">
<h2>CEST<a class="headerlink" href="#cest" title="Link to this heading">#</a></h2>
<p>Our experiments up until now assume a relatively large population on both states in exchange. However, what can we do if one population is too small to observe as a resonance in the spectrum? In this case, we may use the Chemical Exchange Saturation Transfer experiment, or CEST. This experiment applies a saturating field onto longitudinal magnetization followed by flipping magnetization to the <em>x</em>-axis for detection. If the saturating field is on-resonance with the main peak, then as expected, the signal is reduced. However, if a peak corresponding to a low population is on-resonance, then the main peak also saturates. This is demonstrated below, where we first plot the 1D experiment, followed by the CEST saturation profile.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">clear_relax</span><span class="p">()</span>
<span class="n">L</span><span class="o">.</span><span class="n">add_relax</span><span class="p">(</span><span class="s1">&#39;T2&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">T2</span><span class="o">=</span><span class="mf">.05</span><span class="p">)</span>
<span class="n">L</span><span class="o">.</span><span class="n">add_relax</span><span class="p">(</span><span class="s1">&#39;T1&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">T1</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">L</span><span class="o">.</span><span class="n">add_relax</span><span class="p">(</span><span class="s1">&#39;recovery&#39;</span><span class="p">)</span> <span class="c1">#Causes magnetization to recover to thermal equilibrium</span>
<span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span><span class="n">p1</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">OneD</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">_</span><span class="o">=</span><span class="n">CEST</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/f4a9fd405e6dc14f089b0dd18dee7f904a1432a44c2e45f53704012211296718.png" src="../_images/f4a9fd405e6dc14f089b0dd18dee7f904a1432a44c2e45f53704012211296718.png" />
</div>
</div>
<p>The above simulation has set the second peak to be just 2% of the total signal. However, the peak is easily visible in the saturation profile.</p>
<section id="exercise-4-1">
<h3>Exercise 4.1<a class="headerlink" href="#exercise-4-1" title="Link to this heading">#</a></h3>
<p>Below, <code class="docutils literal notranslate"><span class="pre">dly</span></code> gives the length of the CEST saturation period in seconds, and <code class="docutils literal notranslate"><span class="pre">v1</span></code> gives the strength of the saturation field in Hz. Fix the experiment! What should one consider when setting these parameters?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="o">=</span><span class="n">CEST</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mf">.01</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fb4837173743256eaf91558416bf2ae2c5bfae09f75d03cda8cc7f92cba58326.png" src="../_images/fb4837173743256eaf91558416bf2ae2c5bfae09f75d03cda8cc7f92cba58326.png" />
</div>
</div>
<div class="toggle docutils container">
<p>Set <code class="docutils literal notranslate"><span class="pre">dly</span></code>=1 s, and <code class="docutils literal notranslate"><span class="pre">v1</span></code>=25 Hz.</p>
<p>Using too much power saturates the whole spectrum, and so we lose detailed features. However, we need to apply the field long enough that saturation actually occurs.</p>
</div>
</section>
<section id="exercise-4-2">
<h3>Exercise 4.2<a class="headerlink" href="#exercise-4-2" title="Link to this heading">#</a></h3>
<p>How does the CEST experiment depend on the rate of exchange? Adjust <code class="docutils literal notranslate"><span class="pre">k</span></code> below to determine where CEST works or fails. Don’t forget to fix <code class="docutils literal notranslate"><span class="pre">dly</span></code> and <code class="docutils literal notranslate"><span class="pre">v1</span></code> based on your investigation above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span><span class="o">=</span><span class="mi">50</span>
<span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="n">tc</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">),</span><span class="n">p1</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>

<span class="n">_</span><span class="o">=</span><span class="n">CEST</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">dly</span><span class="o">=</span><span class="mf">.01</span><span class="p">,</span><span class="n">v1</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fb4837173743256eaf91558416bf2ae2c5bfae09f75d03cda8cc7f92cba58326.png" src="../_images/fb4837173743256eaf91558416bf2ae2c5bfae09f75d03cda8cc7f92cba58326.png" />
</div>
</div>
<div class="toggle docutils container">
<p>When <code class="docutils literal notranslate"><span class="pre">k</span></code> approches ~2000 s<span class="math notranslate nohighlight">\(^{-1}\)</span>, peaks begin to coalesce, making it more difficult to identify the location of the second peak. On the other hand, if <code class="docutils literal notranslate"><span class="pre">k</span></code> becomes too small (<span class="math notranslate nohighlight">\(k&lt;0.5\)</span> s<span class="math notranslate nohighlight">\(^{-1}\)</span>), then saturation on the weak resonance does not get transferred to the main resonance quickly enough.</p>
</div>
</section>
</section>
<section id="matching-game">
<h2>Matching Game<a class="headerlink" href="#matching-game" title="Link to this heading">#</a></h2>
<p>Below, we have prepared four Liouvillian matrices (objects), corresponding to different populations and correlation times. Which experiment would you apply for each Liouvillian? Try out each experiment (use CPMG or <span class="math notranslate nohighlight">\(R_{1p}\)</span>, but not both, since their performance is very similar). Once  you reveal the answer, you will also see the rate constants (<code class="docutils literal notranslate"><span class="pre">k</span></code>) and populations (<code class="docutils literal notranslate"><span class="pre">p1</span></code>).</p>
<p>Hint: Some Liouvillians will work with more than one experiment and vice-versa, but there is a “best” one-to-one assigment. You can adjust the input parameters for the experiments, but this should not be required.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ex0</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">ExpSys</span><span class="p">(</span><span class="n">v0H</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">Nucs</span><span class="o">=</span><span class="s1">&#39;1H&#39;</span><span class="p">)</span>    <span class="c1">#Experimental system at 500 MHz with one 1H</span>
<span class="n">ex0</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CS&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">Hz</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>     <span class="c1">#Add a chemical shift to the system</span>
<span class="n">ex1</span><span class="o">=</span><span class="n">ex0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>                      <span class="c1">#Copy system for second system in exchange </span>
<span class="n">ex1</span><span class="o">.</span><span class="n">set_inter</span><span class="p">(</span><span class="s1">&#39;CS&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">Hz</span><span class="o">=-</span><span class="mi">500</span><span class="p">)</span>    <span class="c1">#Add a chemical shift to the second system</span>
<span class="n">L1</span><span class="p">,</span><span class="n">L2</span><span class="p">,</span><span class="n">L3</span><span class="p">,</span><span class="n">L4</span><span class="o">=</span><span class="p">[</span><span class="n">sl</span><span class="o">.</span><span class="n">Liouvillian</span><span class="p">(</span><span class="n">ex0</span><span class="p">,</span><span class="n">ex1</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">L</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">p1</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">L1</span><span class="p">,</span><span class="n">L2</span><span class="p">,</span><span class="n">L3</span><span class="p">,</span><span class="n">L4</span><span class="p">],</span><span class="n">pars</span><span class="p">):</span>
    <span class="n">L</span><span class="o">.</span><span class="n">add_relax</span><span class="p">(</span><span class="s1">&#39;T2&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">T2</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">L</span><span class="o">.</span><span class="n">add_relax</span><span class="p">(</span><span class="s1">&#39;T1&#39;</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">T1</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">L</span><span class="o">.</span><span class="n">kex</span><span class="o">=</span><span class="n">sl</span><span class="o">.</span><span class="n">Tools</span><span class="o">.</span><span class="n">twoSite_kex</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">p1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Reveal the cell below for our suggested best answer</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>
<span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,(</span><span class="n">L</span><span class="p">,</span><span class="n">exp</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">L1</span><span class="p">,</span><span class="n">L2</span><span class="p">,</span><span class="n">L3</span><span class="p">,</span><span class="n">L4</span><span class="p">],[</span><span class="n">CEST</span><span class="p">,</span><span class="n">R1p</span><span class="p">,</span><span class="n">EXSY</span><span class="p">,</span><span class="n">OneD</span><span class="p">],</span><span class="n">ax</span><span class="p">)):</span>
    <span class="n">exp</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;L</span><span class="si">{</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">$\rightarrow$</span><span class="si">{</span><span class="n">exp</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,(</span><span class="n">L</span><span class="p">,(</span><span class="n">tc</span><span class="p">,</span><span class="n">p1</span><span class="p">))</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">L1</span><span class="p">,</span><span class="n">L2</span><span class="p">,</span><span class="n">L3</span><span class="p">,</span><span class="n">L4</span><span class="p">],</span><span class="n">pars</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;L</span><span class="si">{</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">: k=</span><span class="si">{</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">tc</span><span class="p">)</span><span class="si">:</span><span class="s1">.2</span><span class="si">}</span><span class="s1">, p1=</span><span class="si">{</span><span class="n">p1</span><span class="si">:</span><span class="s1">4.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>L1: k=5e+01, p1=0.95
L2: k=5e+04, p1=0.75
L3: k=5.0, p1=0.35
L4: k=5e+02, p1=0.60
</pre></div>
</div>
<img alt="../_images/dbb1e5604c9d712e1f1dfba3609ecadd34e0cbd5c2be8778d438f4a6bec56e6f.png" src="../_images/dbb1e5604c9d712e1f1dfba3609ecadd34e0cbd5c2be8778d438f4a6bec56e6f.png" />
</div>
</details>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./GNMR2025"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="GNMR2025.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><font color=#5d6d7e> G-NMR 2025 </font></p>
      </div>
    </a>
    <a class="right-next"
       href="MD2NMR.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><font color=#2e86c1> Calculating NMR Parameters from MD Simulations 1: S<span class="math notranslate nohighlight">\(^2\)</span> and C(t) </font></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-functions">Simulation functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chemical-exchange-in-1d">Chemical Exchange in 1D</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-1">Exercise 1.1:</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#some-hints-on-2x2-exchange-matrices">Some hints on 2x2 exchange matrices</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-2">Exercise 1.2:</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-1">Part 1</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-2">Part 2</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-3">Part 3</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#part-4">Part 4</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-3">Exercise 1.3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-4">Exercise 1.4</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chemical-exchange-in-2d">Chemical Exchange in 2D</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-1">Exercise 2.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-2">Exercise 2.2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-3">Exercise 2.3</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#r-1-rho-and-cpmg"><span class="math notranslate nohighlight">\(R_{1\rho}\)</span> and CPMG</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-1">Exercise 3.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-2">Exercise 3.2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cest">CEST</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-1">Exercise 4.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-2">Exercise 4.2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#matching-game">Matching Game</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Albert Smith
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>